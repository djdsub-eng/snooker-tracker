<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snooker Performance Tracker</title>
    <meta name="description" content="Professional snooker practice and match tracking with interactive shot diagrams">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Snooker Tracker">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icon-192.svg">
    <link rel="apple-touch-icon" href="icon-192.svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #1e3c72;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #1e3c72;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .subtext {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            margin-top: 10px;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-top: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }

        .session-list {
            margin-top: 30px;
        }

        .session-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }

        .session-item h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .session-detail {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .session-detail span {
            background: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .guide-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .guide-section h3 {
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .guide-section ul {
            padding-left: 20px;
        }

        .guide-section li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .routine-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .routine-card:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .routine-card h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav {
                justify-content: center;
            }
            
            .nav-btn {
                flex: 1;
                min-width: 120px;
            }
        }

        /* Snooker Table Diagram Styles */
        .table-diagram {
            background: #1a5f3d;
            border: 15px solid #8b4513;
            border-radius: 10px;
            position: relative;
            margin: 20px auto;
            max-width: 600px;
            height: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .table-inner {
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 2px solid #fff;
        }

        .baulk-line {
            position: absolute;
            left: 20%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #fff;
        }

        .d-line {
            position: absolute;
            left: 20%;
            top: 50%;
            width: 60px;
            height: 60px;
            border: 2px solid #fff;
            border-right: none;
            border-radius: 60px 0 0 60px;
            transform: translateY(-50%);
        }

        .ball {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4),
                        inset -5px -5px 10px rgba(0,0,0,0.3),
                        inset 5px 5px 10px rgba(255,255,255,0.3);
            z-index: 10;
        }

        .ball.white {
            background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0);
            color: #333;
        }

        .ball.red {
            background: radial-gradient(circle at 30% 30%, #ff4444, #cc0000);
            color: white;
        }

        .ball.yellow {
            background: radial-gradient(circle at 30% 30%, #ffff66, #ffd700);
            color: #333;
        }

        .ball.green {
            background: radial-gradient(circle at 30% 30%, #4ade80, #16a34a);
            color: white;
        }

        .ball.brown {
            background: radial-gradient(circle at 30% 30%, #a0522d, #654321);
            color: white;
        }

        .ball.blue {
            background: radial-gradient(circle at 30% 30%, #60a5fa, #1e40af);
            color: white;
        }

        .ball.pink {
            background: radial-gradient(circle at 30% 30%, #ff99cc, #ff1493);
            color: white;
        }

        .ball.black {
            background: radial-gradient(circle at 30% 30%, #333333, #000000);
            color: white;
        }

        .ball.ghost {
            background: rgba(255, 255, 255, 0.3);
            border: 2px dashed rgba(255, 255, 255, 0.6);
            color: rgba(255, 255, 255, 0.8);
        }

        .strike-visualization {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            margin: 20px auto;
            max-width: 200px;
            border: 3px solid #667eea;
        }

        .strike-viz-ball {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: 3px solid #333;
            position: relative;
            margin: 10px auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .strike-viz-point {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 8px rgba(0,0,0,0.5);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .aiming-line {
            position: absolute;
            height: 2px;
            background: white;
            opacity: 0.8;
            transform-origin: 0 50%;
            border-top: 2px dashed white;
        }

        .pocket-line {
            position: absolute;
            height: 3px;
            transform-origin: 0 50%;
            border-top: 3px solid #ff0000;
            opacity: 0.7;
        }

        .arrow {
            position: absolute;
            transform-origin: 0 50%;
        }

        .arrow::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            background: #ffd60a;
            box-shadow: 0 0 5px rgba(255,214,10,0.5);
        }

        .arrow::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -4px;
            width: 0;
            height: 0;
            border-left: 8px solid #ffd60a;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }

        .spot-marker {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .routine-instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .routine-instructions h4 {
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .routine-instructions ol {
            padding-left: 20px;
        }

        .routine-instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .setup-note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .drill-objective {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .cue-path {
            position: absolute;
            border-left: 2px dashed rgba(255,255,255,0.5);
            transform-origin: 0 0;
        }

        .strike-legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 0.9em;
        }

        .strike-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .strike-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎱 Snooker Performance Tracker</h1>
            <button id="installButton" style="display: none; position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                📱 Install App
            </button>
            <p class="subtitle">Bridge the gap between practice and match performance</p>
        </div>

        <div class="nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
            <button class="nav-btn" onclick="showSection('practice')">Practice Log</button>
            <button class="nav-btn" onclick="showSection('match')">Match Log</button>
            <button class="nav-btn" onclick="showSection('analysis')">Analysis</button>
            <button class="nav-btn" onclick="showSection('guide')">Technique Guide</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <h2>Performance Dashboard</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Practice Sessions</h3>
                    <div class="value" id="totalSessions">0</div>
                    <div class="subtext">Total logged</div>
                </div>
                <div class="stat-card">
                    <h3>Matches Played</h3>
                    <div class="value" id="totalMatches">0</div>
                    <div class="subtext" id="winRate">0% win rate</div>
                </div>
                <div class="stat-card">
                    <h3>Highest Break</h3>
                    <div class="value" id="highestBreak">0</div>
                    <div class="subtext">Best performance</div>
                </div>
                <div class="stat-card">
                    <h3>Avg Cue Action</h3>
                    <div class="value" id="avgCueAction">0</div>
                    <div class="subtext">Out of 10</div>
                </div>
            </div>

            <div class="success-box">
                <strong>💪 Your Goal:</strong> Make consistent 40+ breaks in match conditions by improving cue action and eliminating snatching.
            </div>

            <div class="chart-container">
                <h3>Cue Action Progress (Last 30 Days)</h3>
                <canvas id="cueActionChart"></canvas>
            </div>
        </div>

        <!-- Practice Log Section -->
        <div id="practice" class="section">
            <h2>Log Practice Session</h2>
            
            <!-- Practice Plan Generator -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; margin-bottom: 25px; color: white;">
                <h3 style="margin-top: 0; color: white;">🎯 Today's Recommended Practice Plan</h3>
                <div id="recommendedPlan" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <p style="margin: 0;"><strong>Loading plan...</strong></p>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="generatePlan('beginner')" style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                        📚 Beginner Focus
                    </button>
                    <button onclick="generatePlan('intermediate')" style="background: #f59e0b; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                        🎯 Intermediate (20-40 breaks)
                    </button>
                    <button onclick="generatePlan('advanced')" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                        🏆 Advanced (40-60 breaks)
                    </button>
                    <button onclick="generatePlan('match-prep')" style="background: #8b5cf6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                        ⚡ Match Prep (Pre-Competition)
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label>Practice Routine</label>
                <select id="practiceRoutine" onchange="showRoutineSetup()">
                    <option value="">Select a routine...</option>
                    <optgroup label="🎯 POSITIONAL PLAY (Recommended)">
                        <option value="black-to-red-routine">⭐ Black Spot → Red Position (3 shots)</option>
                        <option value="pink-position-play">⭐ Pink Spot → Red Position (3 shots)</option>
                        <option value="blue-position-play">⭐ Blue Spot → Red Position (2 shots)</option>
                        <option value="cushion-position-play">⭐ Cushion Reds Position Control (3 shots)</option>
                    </optgroup>
                    <optgroup label="🎓 FUNDAMENTALS">
                        <option value="pause-drill">Pause Drill (Cue Action Focus)</option>
                        <option value="natural-angles">Natural Angle Practice (3 angles)</option>
                        <option value="screw-shot-control">Screw Shot Control (3 distances)</option>
                        <option value="stun-run-through">Stun & Run-Through Shots (3 variations)</option>
                        <option value="power-control">Power Control Drill</option>
                    </optgroup>
                    <optgroup label="🏆 BREAK BUILDING">
                        <option value="pack-splitting">⭐⭐ Opening the Pack (ESSENTIAL)</option>
                        <option value="reds-around-pink">Reds Around Pink Pattern</option>
                        <option value="break-building">Break Building from Ball-in-Hand</option>
                        <option value="position-play">Blue/Pink/Black Sequence</option>
                        <option value="clearing-colors">⭐ Clearing the Colors (Real Match Practice)</option>
                    </optgroup>
                    <optgroup label="💪 ADVANCED">
                        <option value="common-position-potting">⭐ Potting Practice - Common Positions (10 pots)</option>
                        <option value="reds-on-cushion">Reds on Cushion Position Play</option>
                        <option value="long-pots">Long Pot Practice</option>
                        <option value="pressure-pots">Pressure Pot Routine</option>
                    </optgroup>
                    <optgroup label="👨‍🏫 OTHER">
                        <option value="coach-session">Session with Coach</option>
                    </optgroup>
                </select>
            </div>

            <div id="routineSetup" style="display: none; margin: 20px 0;"></div>

            <div class="form-group">
                <label>Duration (minutes)</label>
                <input type="number" id="practiceDuration" min="15" step="15" value="90" placeholder="90">
            </div>

            <div class="form-group">
                <label>Cue Action Rating (Focus on Pause & Smoothness)</label>
                <div class="slider-container">
                    <input type="range" min="1" max="10" value="5" class="slider" id="cueActionRating">
                    <div class="slider-value" id="cueActionValue">5</div>
                </div>
            </div>

            <div class="form-group">
                <label>Snatch Count (How many times did you snatch?)</label>
                <input type="number" id="snatchCount" min="0" value="0" placeholder="0">
            </div>

            <div class="form-group">
                <label>Highest Break</label>
                <input type="number" id="practiceBreak" min="0" value="0" placeholder="0">
            </div>

            <div class="form-group">
                <label>Table Cost (£)</label>
                <select id="tableCost">
                    <option value="0">Free (Own table)</option>
                    <option value="0.50">£0.50 per 15 mins</option>
                    <option value="1.00" selected>£1.00 per 15 mins</option>
                </select>
            </div>

            <div class="form-group">
                <label>Notes & Observations</label>
                <textarea id="practiceNotes" rows="4" placeholder="What worked well? What needs more focus?"></textarea>
            </div>

            <button class="btn" onclick="logPracticeSession()">Log Session</button>

            <div class="session-list" id="practiceHistory"></div>
        </div>

        <!-- Match Log Section -->
        <div id="match" class="section">
            <h2>Log Match Result</h2>
            
            <div class="form-group">
                <label>Opponent Name</label>
                <input type="text" id="opponentName" placeholder="Opponent name">
            </div>

            <div class="form-group">
                <label>Match Type</label>
                <select id="matchType">
                    <option value="league">League Match</option>
                    <option value="friendly">Friendly</option>
                    <option value="tournament">Tournament</option>
                    <option value="practice-match">Practice Match (with coach)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Result</label>
                <select id="matchResult">
                    <option value="won">Won</option>
                    <option value="lost">Lost</option>
                </select>
            </div>

            <div class="form-group">
                <label>Your Score</label>
                <input type="number" id="yourScore" min="0" value="0">
            </div>

            <div class="form-group">
                <label>Opponent Score</label>
                <input type="number" id="opponentScore" min="0" value="0">
            </div>

            <div class="form-group">
                <label>Highest Break in Match</label>
                <input type="number" id="matchBreak" min="0" value="0" placeholder="0">
            </div>

            <div class="form-group">
                <label>Cue Action During Match</label>
                <div class="slider-container">
                    <input type="range" min="1" max="10" value="5" class="slider" id="matchCueAction">
                    <div class="slider-value" id="matchCueActionValue">5</div>
                </div>
            </div>

            <div class="form-group">
                <label>Times You Snatched Under Pressure</label>
                <input type="number" id="matchSnatchCount" min="0" value="0" placeholder="0">
            </div>

            <div class="form-group">
                <label>Match Notes</label>
                <textarea id="matchNotes" rows="4" placeholder="How did you perform under pressure? What let you down?"></textarea>
            </div>

            <button class="btn" onclick="logMatch()">Log Match</button>

            <div class="session-list" id="matchHistory"></div>
        </div>

        <!-- Analysis Section -->
        <div id="analysis" class="section">
            <h2>Performance Analysis</h2>
            
            <div class="chart-container">
                <h3>Practice vs Match Breaks</h3>
                <canvas id="breakComparisonChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>Snatch Frequency Trend</h3>
                <canvas id="snatchTrendChart"></canvas>
            </div>

            <div class="warning-box">
                <strong>⚠️ Key Insight:</strong> Track the correlation between your cue action rating and break scores. When your pause discipline improves, your breaks should increase.
            </div>

            <div id="analysisStats"></div>
        </div>

        <!-- Technique Guide Section -->
        <div id="guide" class="section">
            <h2>Technique Guide: Fixing the Snatch</h2>
            
            <div class="guide-section">
                <h3>🎯 The Root Cause of Your Problem</h3>
                <p>You can make 62s in practice but struggle to score 40+ in matches because your cue action deteriorates under pressure. The snatching habit destroys your potting consistency when it matters most.</p>
            </div>

            <div class="guide-section">
                <h3>✋ The Pause Drill (15 mins every session)</h3>
                <ul>
                    <li><strong>Setup:</strong> 10 straight pots, medium difficulty</li>
                    <li><strong>Execution:</strong> Complete backswing → Pause for "one-thousand-one" → Smooth delivery</li>
                    <li><strong>Rule:</strong> If you snatch even slightly, restart that pot</li>
                    <li><strong>Focus:</strong> The pause and smooth delivery, NOT whether you pot it</li>
                    <li><strong>Goal:</strong> Make the pause feel unnatural NOT to do</li>
                </ul>
            </div>

            <div class="guide-section">
                <h3>👻 Ghost Ball Practice</h3>
                <ul>
                    <li>Set up shots but DON'T hit the white</li>
                    <li>Practice delivery motion, stopping at ghost ball position</li>
                    <li>Do 20 feathers per session focusing on straight back-and-through</li>
                    <li>Film yourself occasionally - you'll see the snatch you don't feel</li>
                </ul>
            </div>

            <div class="guide-section">
                <h3>📊 90-Minute Practice Structure</h3>
                <ul>
                    <li><strong>First 15 mins:</strong> Pause Drill</li>
                    <li><strong>Next 45 mins:</strong> Position play (Blue-Pink-Black sequence drill)</li>
                    <li><strong>Next 20 mins:</strong> Break building from ball-in-hand (must make 20+ or restart)</li>
                    <li><strong>Final 10 mins:</strong> Long pots with pause focus</li>
                </ul>
            </div>

            <div class="guide-section">
                <h3>🎓 Using Your Coach Effectively</h3>
                <ul>
                    <li>Don't just play frames where he beats you - that doesn't help</li>
                    <li>Ask him to call out which balls you should be playing for after each shot</li>
                    <li>Play frames with ball-in-hand but must make 30+ every time</li>
                    <li>Have him watch and correct your pause discipline</li>
                </ul>
            </div>

            <div class="success-box">
                <strong>💡 The Golden Rule:</strong> Under pressure, your technique gets worse, not better. Practice your pause so religiously that you can't snatch even when nervous. Make the pause automatic.
            </div>

            <div class="warning-box">
                <strong>⏱️ Realistic Time Commitment:</strong> 6-8 hours per week minimum. That's 3 solo sessions (90 mins each), 1 coach session (60-90 mins), and 1 match. Less than this and improvement will be very slow.
            </div>
        </div>
    </div>

    <script>
        // Initialize data from localStorage
        let practiceData = JSON.parse(localStorage.getItem('snookerPractice') || '[]');
        let matchData = JSON.parse(localStorage.getItem('snookerMatches') || '[]');

        // Practice routine setups and instructions
        const routines = {
            'pause-drill': {
                title: 'Pause Drill - Cue Action Focus',
                objective: 'Eliminate snatching by training a consistent pause at the completion of backswing. This drill forces you to separate the backswing from the delivery.',
                duration: '15 minutes minimum (do this EVERY session)',
                diagrams: [
                    {
                        title: 'Setup: 10 Medium Straight Pots',
                        balls: [
                            {type: 'white', x: 20, y: 50, label: 'W'},
                            {type: 'red', x: 35, y: 50, label: '1'},
                            {type: 'red', x: 40, y: 40, label: '2'},
                            {type: 'red', x: 40, y: 60, label: '3'},
                            {type: 'red', x: 50, y: 50, label: '4'},
                            {type: 'red', x: 60, y: 45, label: '5'},
                            {type: 'red', x: 60, y: 55, label: '6'},
                            {type: 'red', x: 70, y: 50, label: '7'},
                            {type: 'red', x: 80, y: 40, label: '8'},
                            {type: 'red', x: 80, y: 60, label: '9'},
                            {type: 'red', x: 90, y: 50, label: '10'}
                        ]
                    }
                ],
                instructions: [
                    'Set up 10 reds at varying distances - not too easy, not impossible',
                    'Line up for the shot with your normal pre-shot routine',
                    'Complete your backswing fully',
                    'PAUSE and count "one-thousand-one" silently',
                    'Then deliver smoothly through the cue ball',
                    'If you snatch even SLIGHTLY, restart that pot',
                    'Focus 80% on the pause/delivery, only 20% on potting',
                    'The goal is to make the pause feel automatic and natural',
                    'After 2 weeks, the pause should feel wrong NOT to do'
                ],
                notes: 'This is THE most important drill for your match performance. Your 62s in practice mean nothing if you snatch under pressure. Do this drill at the start of EVERY session, no exceptions.'
            },
            'black-to-red-routine': {
                title: 'Black Off Spot → Red Position Drill',
                objective: 'Master the most important shot in break-building: potting black and getting perfect position on a red. This is how you build 40+ breaks.',
                duration: '30 minutes',
                diagrams: [
                    {
                        title: 'Shot 1: Pot Black, Natural Angle to Center',
                        balls: [
                            {type: 'white', x: 70, y: 45, label: 'W'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'},
                            {type: 'red', x: 50, y: 50, label: 'R', target: true}
                        ],
                        ghostBall: {x: 88, y: 48},
                        objectBallLine: {from: {x: 92, y: 50}, to: {x: 98, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 70, y: 45}, {x: 92, y: 50}, {x: 72, y: 52}, {x: 52, y: 51}],
                        cueBall: {
                            strikingPoint: {offsetX: 0, offsetY: 0, type: 'center'},
                            power: 'Medium (40%)',
                            spin: 'Plain ball'
                        },
                        strikeVisualization: {
                            strikeOffsetX: 0,
                            strikeOffsetY: 0,
                            type: 'center'
                        },
                        notes: 'Plain ball. Good potting angle. After potting, white naturally comes back to center table red.'
                    },
                    {
                        title: 'Shot 2: Pot Black, Stun to Baulk',
                        balls: [
                            {type: 'white', x: 72, y: 50, label: 'W'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'},
                            {type: 'red', x: 35, y: 50, label: 'R', target: true}
                        ],
                        ghostBall: {x: 88, y: 50},
                        objectBallLine: {from: {x: 92, y: 50}, to: {x: 98, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 72, y: 50}, {x: 92, y: 50}, {x: 70, y: 50}, {x: 37, y: 50}],
                        cueBall: {
                            strikingPoint: {offsetX: 0, offsetY: 3, type: 'center'},
                            power: 'Firm (45%)',
                            spin: 'Slight check / stun'
                        },
                        strikeVisualization: {
                            strikeOffsetX: 0,
                            strikeOffsetY: 3,
                            type: 'center'
                        },
                        notes: 'Hit center or slightly below. Firm pace. White stuns/checks back straight to baulk red.'
                    },
                    {
                        title: 'Shot 3: Pot Black, Top Off Side to Red',
                        balls: [
                            {type: 'white', x: 68, y: 58, label: 'W'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'},
                            {type: 'red', x: 60, y: 70, label: 'R', target: true}
                        ],
                        ghostBall: {x: 87, y: 47},
                        objectBallLine: {from: {x: 92, y: 50}, to: {x: 98, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 68, y: 58}, {x: 92, y: 50}, {x: 96, y: 56}, {x: 85, y: 78}, {x: 62, y: 71}],
                        cueBall: {
                            strikingPoint: {offsetX: 0, offsetY: -8, type: 'top'},
                            power: 'Soft-Medium (35%)',
                            spin: 'Top spin'
                        },
                        strikeVisualization: {
                            strikeOffsetX: 0,
                            strikeOffsetY: -8,
                            type: 'top'
                        },
                        notes: 'Top spin, soft-medium. White runs off side cushion down to side table red.'
                    }
                ],
                instructions: [
                    'Set up black on its spot',
                    'Place white at a GOOD POTTING ANGLE (not too thin)',
                    'Place ONE RED in the middle of table as your TARGET',
                    'RED LINE shows black traveling to corner pocket',
                    'YELLOW LINE shows WHITE BALL path after potting black',
                    'Yellow arrow ends at the glowing red (your target position)',
                    'Ghost ball (GB) shows where to aim',
                    'Practice each shot until you can consistently finish near the red',
                    'Focus: pot black easily, control white position',
                    'These are the 3 most useful positions from black'
                ],
                notes: 'Key principle: Good potting angle + correct spin/power = predictable position. RED LINE = black to pocket. YELLOW LINE = white after potting. Master these and you control the table.'
            },
            'reds-around-pink': {
                title: 'Reds Around Pink - Break Building Patterns',
                objective: 'Learn the standard opening break pattern. This setup mimics real game situations where reds cluster around the pink.',
                duration: '35 minutes',
                diagrams: [
                    {
                        title: 'Shot 1: First Red to Pink Position',
                        balls: [
                            {type: 'white', x: 30, y: 50, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P', target: true},
                            {type: 'red', x: 70, y: 42, label: '1'},
                            {type: 'red', x: 73, y: 37, label: '2'},
                            {type: 'red', x: 73, y: 63, label: '3'},
                            {type: 'red', x: 68, y: 50, label: '4'},
                            {type: 'red', x: 78, y: 48, label: '5'},
                            {type: 'red', x: 70, y: 58, label: '6'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl'}
                        ],
                        ghostBall: {x: 69, y: 42.5},
                        aimingLine: {from: {x: 30, y: 50}, to: {x: 69, y: 42.5}, color: '#ffffff'},
                        pocketLine: {from: {x: 70, y: 42}, to: {x: 5, y: 25}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 30, y: 50}, {x: 70, y: 42}, {x: 72, y: 47}],
                            strikingPoint: {x: 30, y: 50, type: 'center'},
                            power: 'Medium (40%)',
                            spin: 'Plain ball / slight top',
                            contactPoint: {x: 69, y: 42.5}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 50,
                            type: 'center'
                        },
                        notes: 'Plain ball or slight top. Medium pace. Aim at ghost ball position. White stops near pink.'
                    },
                    {
                        title: 'Shot 2: Pink to Next Red',
                        balls: [
                            {type: 'white', x: 72, y: 47, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'red', x: 73, y: 37, label: '2', target: true},
                            {type: 'red', x: 73, y: 63, label: '3'},
                            {type: 'red', x: 68, y: 50, label: '4'},
                            {type: 'red', x: 78, y: 48, label: '5'},
                            {type: 'red', x: 70, y: 58, label: '6'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'}
                        ],
                        ghostBall: {x: 75, y: 49},
                        aimingLine: {from: {x: 72, y: 47}, to: {x: 75, y: 49}, color: '#ffffff'},
                        pocketLine: {from: {x: 75, y: 50}, to: {x: 92, y: 50}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 72, y: 47}, {x: 75, y: 50}, {x: 74, y: 40}],
                            strikingPoint: {x: 72, y: 45.5, type: 'top'},
                            power: 'Soft (25%)',
                            spin: 'Top spin (roll through)',
                            contactPoint: {x: 75, y: 49}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 48.5,
                            type: 'top'
                        },
                        notes: 'Soft touch. Top of white. Roll through gently for natural position on red above pink.'
                    },
                    {
                        title: 'Shot 3: Red to Black Angle',
                        balls: [
                            {type: 'white', x: 74, y: 40, label: 'W'},
                            {type: 'red', x: 73, y: 37, label: '2'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true},
                            {type: 'red', x: 73, y: 63, label: '3'},
                            {type: 'red', x: 68, y: 50, label: '4'},
                            {type: 'red', x: 78, y: 48, label: '5'}
                        ],
                        ghostBall: {x: 72, y: 37.5},
                        aimingLine: {from: {x: 74, y: 40}, to: {x: 72, y: 37.5}, color: '#ffffff'},
                        pocketLine: {from: {x: 73, y: 37}, to: {x: 5, y: 20}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 74, y: 40}, {x: 73, y: 37}, {x: 83, y: 45}],
                            strikingPoint: {x: 74, y: 39, type: 'top-right'},
                            power: 'Medium (40%)',
                            spin: 'Top with right english',
                            contactPoint: {x: 72, y: 37.5}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 16,
                            strikeY: 48.5,
                            type: 'top-right'
                        },
                        notes: 'Top-right on white. Medium pace. Creates angle to reach black for next shot.'
                    }
                ],
                instructions: [
                    'Set up 6 reds around the pink as shown (this is a common post-break pattern)',
                    'Place black and blue on spots',
                    'Start with white in baulk as shown',
                    'WHITE DASHED LINE = Your aiming line to ghost ball',
                    'TRANSLUCENT BALL = Ghost ball position (where white must contact object ball)',
                    'RED LINE = Path of object ball to pocket',
                    'YELLOW LINE = Path of white after contact',
                    'Follow the 3-shot sequence exactly as diagrammed',
                    'Use the "STRIKE HERE" box below each table to see exactly where to hit the white',
                    'After completing the sequence, continue clearing remaining reds',
                    'Target: complete full clearance of all reds and colors',
                    'Repeat drill 5 times, logging highest break'
                ],
                notes: 'This is your bread-and-butter break-building pattern. The ghost ball shows EXACTLY where to aim. Most frames have reds around the pink after break-off. Master this sequence and you\'ll consistently make 40+ breaks.'
            },
            'reds-on-cushion': {
                title: 'Reds on Cushion - Advanced Position Play',
                objective: 'Practice potting reds on cushions while maintaining position on colors. Essential skill for constructing breaks when reds spread out.',
                duration: '30 minutes',
                diagrams: [
                    {
                        title: 'Top Cushion Red to Black',
                        balls: [
                            {type: 'white', x: 70, y: 50, label: 'W'},
                            {type: 'red', x: 85, y: 10, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true}
                        ],
                        ghostBall: {x: 84.5, y: 11},
                        aimingLine: {from: {x: 70, y: 50}, to: {x: 84.5, y: 11}, color: '#ffffff'},
                        pocketLine: {from: {x: 85, y: 10}, to: {x: 98, y: 10}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 70, y: 50}, {x: 85, y: 10}, {x: 90, y: 5}, {x: 92, y: 20}, {x: 90, y: 45}],
                            strikingPoint: {x: 70, y: 48.5, type: 'top'},
                            power: 'Firm (55%)',
                            spin: 'Top spin (run through)',
                            contactPoint: {x: 84.5, y: 11}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 48.5,
                            type: 'top'
                        },
                        notes: 'Firm pace, top of white. Run through. White bounces off cushion to black area.'
                    },
                    {
                        title: 'Side Cushion Red to Pink',
                        balls: [
                            {type: 'white', x: 60, y: 50, label: 'W'},
                            {type: 'red', x: 96, y: 60, label: 'R'},
                            {type: 'pink', x: 75, y: 50, label: 'P', target: true}
                        ],
                        ghostBall: {x: 95, y: 60},
                        aimingLine: {from: {x: 60, y: 50}, to: {x: 95, y: 60}, color: '#ffffff'},
                        pocketLine: {from: {x: 96, y: 60}, to: {x: 98, y: 70}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 60, y: 50}, {x: 96, y: 60}, {x: 95, y: 68}, {x: 82, y: 80}, {x: 72, y: 62}],
                            strikingPoint: {x: 60, y: 50, type: 'center'},
                            power: 'Medium (45%)',
                            spin: 'Plain ball',
                            contactPoint: {x: 95, y: 60}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 50,
                            type: 'center'
                        },
                        notes: 'Plain ball, medium-firm. Natural angle. White comes off bottom cushion naturally to pink.'
                    },
                    {
                        title: 'Bottom Cushion Red to Blue',
                        balls: [
                            {type: 'white', x: 55, y: 45, label: 'W'},
                            {type: 'red', x: 78, y: 90, label: 'R'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl', target: true}
                        ],
                        ghostBall: {x: 78, y: 89},
                        aimingLine: {from: {x: 55, y: 45}, to: {x: 78, y: 89}, color: '#ffffff'},
                        pocketLine: {from: {x: 78, y: 90}, to: {x: 5, y: 98}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 55, y: 45}, {x: 78, y: 90}, {x: 72, y: 95}, {x: 60, y: 80}, {x: 52, y: 60}],
                            strikingPoint: {x: 55, y: 43.5, type: 'top'},
                            power: 'Medium (40%)',
                            spin: 'Slight top',
                            contactPoint: {x: 78, y: 89}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 48.5,
                            type: 'top'
                        },
                        notes: 'Slight top, medium pace. Run off cushion back to blue area with controlled power.'
                    }
                ],
                instructions: [
                    'Set up one red on each cushion as shown in diagrams',
                    'Place the target color on its spot',
                    'Study the WHITE DASHED aiming line - aim at the ghost ball',
                    'Check strike visualization box for exact hitting point',
                    'RED LINE shows object ball path to pocket',
                    'YELLOW LINE shows white ball path after contact (including cushion bounces)',
                    'Practice each shot 8 times successfully',
                    'Cushion reds require commitment - strike through, don\'t steer',
                    'Power level is crucial: too soft = no position, too hard = loss of control',
                    'Once confident on each individual shot, set up all three reds at once',
                    'Clear them in sequence with correct position each time'
                ],
                notes: 'Cushion reds separate club players from good players. The ghost ball and aiming lines show EXACTLY where to aim. If you can confidently pot these and hold position, you\'ll build breaks even when reds spread around the table.'
            },
            'position-play': {
                title: 'Position Play - Blue/Pink/Black Sequence',
                objective: 'Master position control and angle recognition by repeatedly playing a sequence that requires precision. Builds consistency under mini-pressure.',
                duration: '45 minutes',
                diagrams: [
                    {
                        title: 'Shot 1: Blue with Position on Pink',
                        balls: [
                            {type: 'white', x: 30, y: 50, label: 'W'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl'},
                            {type: 'pink', x: 75, y: 50, label: 'P', target: true},
                            {type: 'black', x: 92, y: 50, label: 'Bk'}
                        ],
                        ghostBall: {x: 49, y: 50},
                        aimingLine: {from: {x: 30, y: 50}, to: {x: 49, y: 50}, color: '#ffffff'},
                        pocketLine: {from: {x: 50, y: 50}, to: {x: 50, y: 5}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 30, y: 50}, {x: 50, y: 50}, {x: 67, y: 48}],
                            strikingPoint: {x: 30, y: 48.5, type: 'top'},
                            power: 'Medium (40%)',
                            spin: 'Top spin (follow through)',
                            contactPoint: {x: 49, y: 50}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 48.5,
                            type: 'top'
                        },
                        notes: 'Top spin, roll through naturally. White travels to pink area after potting blue.'
                    }
                ],
                instructions: [
                    'Place blue, pink, and black on their spots',
                    'Start with white anywhere in baulk',
                    'Use ghost ball and aiming lines to pot accurately',
                    'Pot blue and get position on pink',
                    'Pot pink and get position on black',
                    'Pot black and get position on blue (now back on spot)',
                    'Continue the sequence without missing position',
                    'Complete 5 consecutive sequences without error',
                    'If you miss position OR pot, start count over from zero',
                    'Focus on using natural angles - minimize side spin'
                ],
                notes: 'This drill teaches you to think two balls ahead and recognize natural position angles. The pressure of "I\'m on 4/5" simulates match pressure and tests your cue action under stress.'
            },
            'pink-position-play': {
                title: 'Pink Spot → Red Position Drill',
                objective: 'Master getting position on reds after potting pink. Essential for building 30+ breaks.',
                duration: '25 minutes',
                diagrams: [
                    {
                        title: 'Shot 1: Pink to Center Red',
                        balls: [
                            {type: 'white', x: 60, y: 50, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'red', x: 50, y: 45, label: 'R', target: true}
                        ],
                        pocket: {x: 92, y: 50},
                        whitePath: [
                            {x: 60, y: 50},
                            {x: 75, y: 50},
                            {x: 52, y: 47}
                        ],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 92, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 60, y: 50}, {x: 75, y: 50}, {x: 52, y: 47}],
                        notes: 'Plain ball, soft pace. Natural angle to center red.'
                    },
                    {
                        title: 'Shot 2: Pink to Top Red',
                        balls: [
                            {type: 'white', x: 65, y: 55, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'red', x: 70, y: 25, label: 'R', target: true}
                        ],
                        pocket: {x: 92, y: 50},
                        whitePath: [
                            {x: 65, y: 55},
                            {x: 75, y: 50},
                            {x: 80, y: 40},
                            {x: 72, y: 27}
                        ],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 92, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 65, y: 55}, {x: 75, y: 50}, {x: 80, y: 40}, {x: 72, y: 27}],
                        notes: 'Top spin, medium pace. Run through to top area red.'
                    },
                    {
                        title: 'Shot 3: Pink to Baulk Red',
                        balls: [
                            {type: 'white', x: 55, y: 50, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'red', x: 35, y: 50, label: 'R', target: true}
                        ],
                        pocket: {x: 92, y: 50},
                        whitePath: [
                            {x: 55, y: 50},
                            {x: 75, y: 50},
                            {x: 60, y: 50},
                            {x: 37, y: 50}
                        ],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 92, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 55, y: 50}, {x: 75, y: 50}, {x: 60, y: 50}, {x: 37, y: 50}],
                        notes: 'Slight screw, medium pace. Check back to baulk red.'
                    }
                ],
                instructions: [
                    'Set up pink on its spot (75% across)',
                    'Place red in different positions as targets',
                    'Click EDIT to adjust positions',
                    'Practice getting perfect position',
                    'Do 10 reps of each shot'
                ]
            },
            'blue-position-play': {
                title: 'Blue Spot → Red Position Drill',
                objective: 'Master position from blue - often neglected but crucial for break building.',
                duration: '20 minutes',
                diagrams: [
                    {
                        title: 'Shot 1: Blue to Black Area',
                        balls: [
                            {type: 'white', x: 35, y: 50, label: 'W'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl'},
                            {type: 'red', x: 85, y: 48, label: 'R', target: true}
                        ],
                        pocket: {x: 50, y: 5},
                        whitePath: [
                            {x: 35, y: 50},
                            {x: 50, y: 50},
                            {x: 72, y: 49},
                            {x: 86, y: 49}
                        ],
                        objectBallLine: {from: {x: 50, y: 50}, to: {x: 50, y: 5}, color: '#ff0000'},
                        whiteBallPath: [{x: 35, y: 50}, {x: 50, y: 50}, {x: 72, y: 49}, {x: 86, y: 49}],
                        notes: 'Top spin, firm pace. Run through to black area.'
                    },
                    {
                        title: 'Shot 2: Blue to Pink Area',
                        balls: [
                            {type: 'white', x: 40, y: 48, label: 'W'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl'},
                            {type: 'red', x: 72, y: 52, label: 'R', target: true}
                        ],
                        pocket: {x: 50, y: 5},
                        whitePath: [
                            {x: 40, y: 48},
                            {x: 50, y: 50},
                            {x: 65, y: 51},
                            {x: 73, y: 52}
                        ],
                        objectBallLine: {from: {x: 50, y: 50}, to: {x: 50, y: 5}, color: '#ff0000'},
                        whiteBallPath: [{x: 40, y: 48}, {x: 50, y: 50}, {x: 65, y: 51}, {x: 73, y: 52}],
                        notes: 'Plain ball, medium pace. Natural angle to pink area.'
                    }
                ],
                instructions: [
                    'Set up blue on center spot (50%)',
                    'Pot to top pocket',
                    'Practice getting length for black/pink area reds',
                    'Edit diagram for custom positions'
                ]
            },
            'cushion-position-play': {
                title: 'Reds on Cushion - Position Control',
                objective: 'Learn to pot cushion reds and control position. Separates good players from average.',
                duration: '30 minutes',
                diagrams: [
                    {
                        title: 'Top Cushion Red to Black',
                        balls: [
                            {type: 'white', x: 75, y: 35, label: 'W'},
                            {type: 'red', x: 88, y: 12, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true}
                        ],
                        pocket: {x: 98, y: 8},
                        whitePath: [
                            {x: 75, y: 35},
                            {x: 88, y: 12},
                            {x: 94, y: 8},
                            {x: 92, y: 35},
                            {x: 90, y: 48}
                        ],
                        objectBallLine: {from: {x: 88, y: 12}, to: {x: 98, y: 8}, color: '#ff0000'},
                        whiteBallPath: [{x: 75, y: 35}, {x: 88, y: 12}, {x: 94, y: 8}, {x: 92, y: 35}, {x: 90, y: 48}],
                        notes: 'Top spin, firm. White bounces off cushion down to black area.'
                    },
                    {
                        title: 'Side Cushion Red to Pink',
                        balls: [
                            {type: 'white', x: 65, y: 55, label: 'W'},
                            {type: 'red', x: 96, y: 68, label: 'R'},
                            {type: 'pink', x: 75, y: 50, label: 'P', target: true}
                        ],
                        pocket: {x: 98, y: 80},
                        whitePath: [
                            {x: 65, y: 55},
                            {x: 96, y: 68},
                            {x: 96, y: 78},
                            {x: 82, y: 88},
                            {x: 72, y: 62}
                        ],
                        objectBallLine: {from: {x: 96, y: 68}, to: {x: 98, y: 80}, color: '#ff0000'},
                        whiteBallPath: [{x: 65, y: 55}, {x: 96, y: 68}, {x: 96, y: 78}, {x: 82, y: 88}, {x: 72, y: 62}],
                        notes: 'Plain ball, medium. Natural angle off bottom cushion to pink.'
                    },
                    {
                        title: 'Bottom Cushion Red to Center',
                        balls: [
                            {type: 'white', x: 50, y: 40, label: 'W'},
                            {type: 'red', x: 70, y: 92, label: 'R'},
                            {type: 'red', x: 55, y: 50, label: 'R2', target: true}
                        ],
                        pocket: {x: 5, y: 98},
                        whitePath: [
                            {x: 50, y: 40},
                            {x: 70, y: 92},
                            {x: 65, y: 96},
                            {x: 58, y: 70},
                            {x: 56, y: 52}
                        ],
                        objectBallLine: {from: {x: 70, y: 92}, to: {x: 5, y: 98}, color: '#ff0000'},
                        whiteBallPath: [{x: 50, y: 40}, {x: 70, y: 92}, {x: 65, y: 96}, {x: 58, y: 70}, {x: 56, y: 52}],
                        notes: 'Top spin, medium. Run off cushion back to center.'
                    }
                ],
                instructions: [
                    'Cushion reds require commitment',
                    'Strike through, don\'t steer',
                    'Power control is crucial',
                    'Edit diagrams for your table\'s angles',
                    'Practice until confident on all cushion reds'
                ]
            },
            'natural-angles': {
                title: 'Natural Angle Position Play',
                objective: 'Learn to use natural angles without side spin. Foundation of good positional play.',
                duration: '25 minutes',
                diagrams: [
                    {
                        title: 'Half-Ball Hit - 30° Angle',
                        balls: [
                            {type: 'white', x: 40, y: 45, label: 'W'},
                            {type: 'red', x: 60, y: 50, label: 'R'},
                            {type: 'black', x: 75, y: 60, label: 'Bk', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 40, y: 45},
                            {x: 60, y: 50},
                            {x: 72, y: 58}
                        ],
                        objectBallLine: {from: {x: 60, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 40, y: 45}, {x: 60, y: 50}, {x: 72, y: 58}],
                        notes: 'Plain ball. Natural 30° angle for position.'
                    },
                    {
                        title: 'Three-Quarter Ball Hit - 15° Angle',
                        balls: [
                            {type: 'white', x: 45, y: 48, label: 'W'},
                            {type: 'red', x: 65, y: 50, label: 'R'},
                            {type: 'pink', x: 78, y: 54, label: 'P', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 45, y: 48},
                            {x: 65, y: 50},
                            {x: 77, y: 53}
                        ],
                        objectBallLine: {from: {x: 65, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 45, y: 48}, {x: 65, y: 50}, {x: 77, y: 53}],
                        notes: 'Thinner cut. Narrower natural angle.'
                    },
                    {
                        title: 'Quarter-Ball Hit - 60° Angle',
                        balls: [
                            {type: 'white', x: 35, y: 40, label: 'W'},
                            {type: 'red', x: 55, y: 50, label: 'R'},
                            {type: 'blue', x: 62, y: 70, label: 'Bl', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 35, y: 40},
                            {x: 55, y: 50},
                            {x: 60, y: 68}
                        ],
                        objectBallLine: {from: {x: 55, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 35, y: 40}, {x: 55, y: 50}, {x: 60, y: 68}],
                        notes: 'Thick cut. Wide natural angle.'
                    }
                ],
                instructions: [
                    'Plain ball only - no side spin',
                    'Learn your natural angles',
                    'Soft pace to feel the angles',
                    'Edit to practice different angles',
                    'This is foundation - master it first'
                ]
            },
            'screw-shot-control': {
                title: 'Screw Shot Control - Power Variation',
                objective: 'Master different screw distances. Critical for controlling position back towards baulk.',
                duration: '20 minutes',
                diagrams: [
                    {
                        title: 'Short Screw - 2 feet back',
                        balls: [
                            {type: 'white', x: 60, y: 50, label: 'W'},
                            {type: 'red', x: 75, y: 50, label: 'R'},
                            {type: 'red', x: 52, y: 50, label: 'R2', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 60, y: 50},
                            {x: 75, y: 50},
                            {x: 54, y: 50}
                        ],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 60, y: 50}, {x: 75, y: 50}, {x: 54, y: 50}],
                        notes: 'Bottom of white, soft-medium. Short controlled screw.'
                    },
                    {
                        title: 'Medium Screw - 4 feet back',
                        balls: [
                            {type: 'white', x: 65, y: 50, label: 'W'},
                            {type: 'red', x: 80, y: 50, label: 'R'},
                            {type: 'red', x: 40, y: 50, label: 'R2', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 65, y: 50},
                            {x: 80, y: 50},
                            {x: 42, y: 50}
                        ],
                        objectBallLine: {from: {x: 80, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 65, y: 50}, {x: 80, y: 50}, {x: 42, y: 50}],
                        notes: 'Bottom of white, medium-firm. Medium distance screw.'
                    },
                    {
                        title: 'Long Screw - 6 feet back',
                        balls: [
                            {type: 'white', x: 70, y: 50, label: 'W'},
                            {type: 'red', x: 85, y: 50, label: 'R'},
                            {type: 'red', x: 25, y: 50, label: 'R2', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 70, y: 50},
                            {x: 85, y: 50},
                            {x: 27, y: 50}
                        ],
                        objectBallLine: {from: {x: 85, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 70, y: 50}, {x: 85, y: 50}, {x: 27, y: 50}],
                        notes: 'Bottom of white, firm. Long powerful screw.'
                    }
                ],
                instructions: [
                    'Set up straight pots at different distances',
                    'Practice screwing back exact distances',
                    'Bottom of white, smooth delivery',
                    'Edit for your table\'s cloth speed',
                    'Master power control = master screwing'
                ]
            },
            'stun-run-through': {
                title: 'Stun and Run-Through Shots',
                objective: 'Control white movement with varying top/check spin. Essential for precision positioning.',
                duration: '25 minutes',
                diagrams: [
                    {
                        title: 'Stun Shot - White Stops',
                        balls: [
                            {type: 'white', x: 50, y: 50, label: 'W'},
                            {type: 'red', x: 65, y: 50, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 50, y: 50},
                            {x: 65, y: 50},
                            {x: 68, y: 50}
                        ],
                        objectBallLine: {from: {x: 65, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 50, y: 50}, {x: 65, y: 50}, {x: 68, y: 50}],
                        notes: 'Center/slight below. White barely moves forward.'
                    },
                    {
                        title: 'Soft Run-Through',
                        balls: [
                            {type: 'white', x: 50, y: 50, label: 'W'},
                            {type: 'red', x: 65, y: 50, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 50, y: 50},
                            {x: 65, y: 50},
                            {x: 82, y: 50}
                        ],
                        objectBallLine: {from: {x: 65, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 50, y: 50}, {x: 65, y: 50}, {x: 82, y: 50}],
                        notes: 'Slight top, soft. White rolls gently forward.'
                    },
                    {
                        title: 'Strong Run-Through',
                        balls: [
                            {type: 'white', x: 45, y: 50, label: 'W'},
                            {type: 'red', x: 60, y: 50, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 45, y: 50},
                            {x: 60, y: 50},
                            {x: 90, y: 50}
                        ],
                        objectBallLine: {from: {x: 60, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 45, y: 50}, {x: 60, y: 50}, {x: 90, y: 50}],
                        notes: 'Top spin, medium-firm. White runs through strongly.'
                    }
                ],
                instructions: [
                    'Same shot, different results',
                    'Control with striking point and power',
                    'Stun for short distance',
                    'Top for long distance',
                    'Edit to practice your distances'
                ]
            },
            'power-control': {
                title: 'Power Control Drill - Speed Management',
                objective: 'Master different power levels for position play. Learn the difference between soft (25%), medium (40%), firm (50%), and hard (70%).',
                duration: '25 minutes',
                diagrams: [
                    {
                        title: 'Soft Touch (25% Power)',
                        balls: [
                            {type: 'white', x: 40, y: 50, label: 'W'},
                            {type: 'red', x: 50, y: 50, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'}
                        ],
                        ghostBall: {x: 49, y: 50},
                        aimingLine: {from: {x: 40, y: 50}, to: {x: 49, y: 50}, color: '#ffffff'},
                        pocketLine: {from: {x: 50, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 40, y: 50}, {x: 50, y: 50}, {x: 55, y: 50}],
                            strikingPoint: {x: 40, y: 48.5, type: 'top'},
                            power: 'Soft (25%)',
                            spin: 'Top spin',
                            contactPoint: {x: 49, y: 50}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 48.5,
                            type: 'top'
                        },
                        notes: 'White barely rolls forward 5 inches. Gentle stroke, full follow-through.'
                    },
                    {
                        title: 'Medium Pace (40% Power)',
                        balls: [
                            {type: 'white', x: 40, y: 50, label: 'W'},
                            {type: 'red', x: 50, y: 50, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true}
                        ],
                        ghostBall: {x: 49, y: 50},
                        aimingLine: {from: {x: 40, y: 50}, to: {x: 49, y: 50}, color: '#ffffff'},
                        pocketLine: {from: {x: 50, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 40, y: 50}, {x: 50, y: 50}, {x: 85, y: 50}],
                            strikingPoint: {x: 40, y: 48.5, type: 'top'},
                            power: 'Medium (40%)',
                            spin: 'Top spin',
                            contactPoint: {x: 49, y: 50}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 48.5,
                            type: 'top'
                        },
                        notes: 'White travels to black area. Controlled, smooth delivery. Perfect for position play.'
                    },
                    {
                        title: 'Firm Strike (55% Power)',
                        balls: [
                            {type: 'white', x: 40, y: 50, label: 'W'},
                            {type: 'red', x: 50, y: 50, label: 'R'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'}
                        ],
                        ghostBall: {x: 49, y: 50},
                        aimingLine: {from: {x: 40, y: 50}, to: {x: 49, y: 50}, color: '#ffffff'},
                        pocketLine: {from: {x: 50, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        cueBall: {
                            path: [{x: 40, y: 50}, {x: 50, y: 50}, {x: 96, y: 50}, {x: 94, y: 50}],
                            strikingPoint: {x: 40, y: 48.5, type: 'top'},
                            power: 'Firm (55%)',
                            spin: 'Top spin',
                            contactPoint: {x: 49, y: 50}
                        },
                        strikeVisualization: {
                            ballX: 15,
                            ballY: 50,
                            strikeX: 15,
                            strikeY: 48.5,
                            type: 'top'
                        },
                        notes: 'White travels full table length. Positive stroke, maintain pause discipline.'
                    }
                ],
                instructions: [
                    'Set up the same shot three times (red 10 inches from white)',
                    'Play it with soft, medium, and firm power levels',
                    'White should travel: 5 inches (soft), to black (medium), to cushion (firm)',
                    'Use the SAME aiming line (ghost ball) for all three shots',
                    'Use the SAME striking point (top of white) for all three shots',
                    'Only the POWER changes - everything else stays identical',
                    'Practice each power level 10 times',
                    'The backswing stays same length - power comes from acceleration through ball',
                    'Never sacrifice your pause for power',
                    'Film yourself - check delivery stays smooth at all power levels'
                ],
                notes: 'Most players have only two speeds: normal and panic. Developing three distinct power levels gives you control over position play. Your pause must stay consistent regardless of power. Ghost ball aiming stays the same - only speed changes.'
            },
            'break-building': {
                title: 'Break Building from Ball-in-Hand',
                objective: 'Simulate having a scoring chance in a match. Build break-building confidence and test cue action under the pressure of having to restart.',
                duration: '20-30 minutes',
                diagrams: [
                    {
                        title: 'After Break-Off: Ball-in-Hand Position',
                        balls: [
                            {type: 'red', x: 75, y: 35, label: ''},
                            {type: 'red', x: 77, y: 40, label: ''},
                            {type: 'red', x: 77, y: 45, label: ''},
                            {type: 'red', x: 77, y: 50, label: ''},
                            {type: 'red', x: 77, y: 55, label: ''},
                            {type: 'red', x: 75, y: 60, label: ''},
                            {type: 'red', x: 79, y: 42, label: ''},
                            {type: 'red', x: 79, y: 53, label: ''},
                            {type: 'black', x: 92, y: 50, label: 'Bk'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl'}
                        ],
                        notes: 'Place white anywhere in baulk area'
                    }
                ],
                instructions: [
                    'Break off normally (or set up a standard break pattern)',
                    'Give yourself ball-in-hand in the baulk area',
                    'Your target: make 20+ points EVERY attempt',
                    'If you make less than 20, immediately restart',
                    'If you snatch and miss, restart',
                    'Try to make 30+ breaks consistently',
                    'Focus on shot selection - don\'t force shots',
                    'Play as if it\'s a match situation',
                    'Track how many attempts it takes to get 3 x 20+ breaks'
                ],
                notes: 'The "must make 20+ or restart" rule creates real pressure that mimics match conditions. This is where your pause discipline gets tested. If you\'re snatching here, you\'ll definitely snatch in matches.'
            },
            'common-position-potting': {
                title: 'Potting Practice - Common Match Positions',
                objective: 'Master the pots you face most often in real frames. These aren\'t trick shots - they\'re the bread-and-butter pots that happen every single frame.',
                duration: '30 minutes',
                diagrams: [
                    {
                        title: 'Red on Side Cushion to Corner',
                        balls: [
                            {type: 'white', x: 50, y: 50, label: 'W'},
                            {type: 'red', x: 96, y: 65, label: 'R'}
                        ],
                        pocket: {x: 98, y: 92},
                        whitePath: [],
                        objectBallLine: {from: {x: 96, y: 65}, to: {x: 98, y: 92}, color: '#ff0000'},
                        notes: 'Very common pot. Thin cut along cushion. Commit to the line, don\'t steer.'
                    },
                    {
                        title: 'Black Off Spot - Straightish',
                        balls: [
                            {type: 'white', x: 75, y: 45, label: 'W'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'}
                        ],
                        pocket: {x: 98, y: 50},
                        whitePath: [],
                        objectBallLine: {from: {x: 92, y: 50}, to: {x: 98, y: 50}, color: '#ff0000'},
                        notes: 'Most common black pot. Nearly straight but not quite. Easy to miss if you snatch.'
                    },
                    {
                        title: 'Pink to Middle Pocket',
                        balls: [
                            {type: 'white', x: 60, y: 40, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'}
                        ],
                        pocket: {x: 92, y: 50},
                        whitePath: [],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 92, y: 50}, color: '#ff0000'},
                        notes: 'Happens multiple times per frame. Straight pot into tight pocket. Trust your aim.'
                    },
                    {
                        title: 'Blue Straight to Top Pocket',
                        balls: [
                            {type: 'white', x: 50, y: 65, label: 'W'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl'}
                        ],
                        pocket: {x: 50, y: 5},
                        whitePath: [],
                        objectBallLine: {from: {x: 50, y: 50}, to: {x: 50, y: 5}, color: '#ff0000'},
                        notes: 'Dead straight pot. Should be easy but pressure makes it hard. Perfect for pause drill.'
                    },
                    {
                        title: 'Red Near Top Cushion - Half Ball',
                        balls: [
                            {type: 'white', x: 70, y: 30, label: 'W'},
                            {type: 'red', x: 85, y: 15, label: 'R'}
                        ],
                        pocket: {x: 98, y: 8},
                        whitePath: [],
                        objectBallLine: {from: {x: 85, y: 15}, to: {x: 98, y: 8}, color: '#ff0000'},
                        notes: 'Common after break-off. Half-ball cut to corner. Happens every frame.'
                    },
                    {
                        title: 'Baulk Red to Corner (Long)',
                        balls: [
                            {type: 'white', x: 15, y: 55, label: 'W'},
                            {type: 'red', x: 30, y: 45, label: 'R'}
                        ],
                        pocket: {x: 5, y: 30},
                        whitePath: [],
                        objectBallLine: {from: {x: 30, y: 45}, to: {x: 5, y: 30}, color: '#ff0000'},
                        notes: 'First pot after safety exchange. Long, needs good technique. Don\'t snatch.'
                    },
                    {
                        title: 'Red to Middle - Across Table',
                        balls: [
                            {type: 'white', x: 35, y: 45, label: 'W'},
                            {type: 'red', x: 65, y: 50, label: 'R'}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [],
                        objectBallLine: {from: {x: 65, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        notes: 'Cross-table pot to tight pocket. Test of aim and commitment.'
                    },
                    {
                        title: 'Pink from Side - Angled',
                        balls: [
                            {type: 'white', x: 55, y: 62, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'}
                        ],
                        pocket: {x: 5, y: 25},
                        whitePath: [],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 5, y: 25}, color: '#ff0000'},
                        notes: 'Pink at an angle to corner. Need to see the line clearly.'
                    },
                    {
                        title: 'Red on Bottom Cushion',
                        balls: [
                            {type: 'white', x: 45, y: 35, label: 'W'},
                            {type: 'red', x: 65, y: 92, label: 'R'}
                        ],
                        pocket: {x: 5, y: 98},
                        whitePath: [],
                        objectBallLine: {from: {x: 65, y: 92}, to: {x: 5, y: 98}, color: '#ff0000'},
                        notes: 'Cushion red to corner. Along the rail. Strike through confidently.'
                    },
                    {
                        title: 'Black to Opposite Corner (Long Angle)',
                        balls: [
                            {type: 'white', x: 75, y: 58, label: 'W'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'}
                        ],
                        pocket: {x: 5, y: 8},
                        whitePath: [],
                        objectBallLine: {from: {x: 92, y: 50}, to: {x: 5, y: 8}, color: '#ff0000'},
                        notes: 'Long angle when black won\'t go in corner. Happens in every frame. Must pot these.'
                    }
                ],
                instructions: [
                    'Set up each pot exactly as shown',
                    'Pot each ball 10 TIMES before moving to next position',
                    'If you miss, restart that ball\'s count from ZERO',
                    'Use your PAUSE DRILL technique on every single pot',
                    'Focus 80% on technique, 20% on outcome',
                    'Count your snatches - goal is ZERO snatches in 100 pots',
                    'These are NOT random pots - they happen in EVERY match',
                    'After 2 weeks, these should all feel automatic',
                    'Click EDIT DIAGRAM to adjust positions for your table',
                    'Track which pots you struggle with - practice those more'
                ],
                notes: 'This is pure repetition training. You face these EXACT pots in every single frame you play. The difference between making them in practice vs. matches is your cue action under pressure. If you can pot each of these 10 times in a row with perfect pause, you\'ll pot them in matches. These aren\'t fancy trick shots - they\'re the pots that WIN FRAMES.'
            },
            'long-pots': {
                title: 'Long Pot Practice',
                objective: 'Build confidence on difficult pots and test cue action on shots that require commitment. These are the pots that win frames.',
                duration: '10-15 minutes (session finisher)',
                diagrams: [
                    {
                        title: 'Long Straight Pots from Baulk',
                        balls: [
                            {type: 'white', x: 15, y: 50, label: 'W'},
                            {type: 'red', x: 90, y: 50, label: '1'},
                            {type: 'red', x: 85, y: 35, label: '2'},
                            {type: 'red', x: 85, y: 65, label: '3'},
                            {type: 'red', x: 92, y: 40, label: '4'},
                            {type: 'red', x: 92, y: 60, label: '5'}
                        ]
                    }
                ],
                instructions: [
                    'Place 5 reds around the top cushion area',
                    'Place white on or near the brown spot',
                    'Pot each red in sequence',
                    'Focus entirely on pause and smooth delivery',
                    'Don\'t worry about position',
                    'If you miss, note whether you snatched',
                    'Pot each ball 3 times before moving to next',
                    'These pots should feel confident after 2 weeks'
                ],
                notes: 'Long pots expose cue action flaws instantly. If you\'re snatching, these become terrifying. Master the pause on these shots and they become routine.'
            },
            'clearing-colors': {
                title: 'Clearing the Colors - Real Match Scenarios',
                objective: 'Practice the actual endgame scenario: clearing colors when you\'re ahead or need them all. This happens in EVERY frame.',
                duration: '30 minutes',
                diagrams: [
                    {
                        title: 'Scenario 1: Yellow to Get on Green',
                        balls: [
                            {type: 'white', x: 25, y: 55, label: 'W'},
                            {type: 'yellow', x: 20, y: 60, label: 'Y'},
                            {type: 'green', x: 20, y: 40, label: 'G', target: true}
                        ],
                        pocket: {x: 5, y: 70},
                        whitePath: [
                            {x: 25, y: 55},
                            {x: 20, y: 60},
                            {x: 22, y: 48}
                        ],
                        objectBallLine: {from: {x: 20, y: 60}, to: {x: 5, y: 70}, color: '#ff0000'},
                        whiteBallPath: [{x: 25, y: 55}, {x: 20, y: 60}, {x: 22, y: 48}],
                        notes: 'Screw slightly to get on green. The most common missed position in clearing.'
                    },
                    {
                        title: 'Scenario 2: Brown to Get on Blue',
                        balls: [
                            {type: 'white', x: 28, y: 50, label: 'W'},
                            {type: 'brown', x: 20, y: 50, label: 'Br'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl', target: true}
                        ],
                        pocket: {x: 5, y: 50},
                        whitePath: [
                            {x: 28, y: 50},
                            {x: 20, y: 50},
                            {x: 42, y: 50}
                        ],
                        objectBallLine: {from: {x: 20, y: 50}, to: {x: 5, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 28, y: 50}, {x: 20, y: 50}, {x: 42, y: 50}],
                        notes: 'Top spin, firm pace. Get good length on blue for pink angle.'
                    },
                    {
                        title: 'Scenario 3: Pink to Get on Black',
                        balls: [
                            {type: 'white', x: 65, y: 52, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'black', x: 92, y: 50, label: 'Bk', target: true}
                        ],
                        pocket: {x: 5, y: 25},
                        whitePath: [
                            {x: 65, y: 52},
                            {x: 75, y: 50},
                            {x: 88, y: 48}
                        ],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 5, y: 25}, color: '#ff0000'},
                        whiteBallPath: [{x: 65, y: 52}, {x: 75, y: 50}, {x: 88, y: 48}],
                        notes: 'Soft top spin to get perfect on black. Don\'t overhit - common mistake.'
                    }
                ],
                instructions: [
                    'Start with yellow on spot, white in baulk',
                    'Clear all colors in order: Yellow → Green → Brown → Blue → Pink → Black',
                    'Must get position for the NEXT color every time',
                    'If you miss position, start again from yellow',
                    'Count how many attempts it takes to clear all 6',
                    'Goal: Clear all colors with position in one attempt',
                    'This is THE most important drill for winning frames',
                    'You need this 27 points in EVERY close frame',
                    'Practice until you can do it without thinking'
                ],
                notes: 'This is the REAL scenario - not a fantasy line-up. When you\'re 20 points ahead with colors left, you MUST clear them. When you need all 27 to win, you MUST clear them. This happens multiple times per match. Master this and you\'ll win frames you used to lose.'
            },
            'pack-splitting': {
                title: 'Opening the Pack - Controlled Splitting',
                objective: 'Learn to split the reds when bunched, the single most important shot for building big breaks. This is what separates 30s from 60s.',
                duration: '35 minutes',
                diagrams: [
                    {
                        title: 'Scenario 1: Split with Black (Most Common)',
                        balls: [
                            {type: 'white', x: 78, y: 55, label: 'W'},
                            {type: 'black', x: 92, y: 50, label: 'Bk'},
                            {type: 'red', x: 76, y: 48, label: '1'},
                            {type: 'red', x: 76, y: 52, label: '2'},
                            {type: 'red', x: 78, y: 50, label: '3'},
                            {type: 'red', x: 74, y: 50, label: '4'},
                            {type: 'red', x: 76, y: 50, label: '5', target: true}
                        ],
                        pocket: {x: 98, y: 50},
                        whitePath: [
                            {x: 78, y: 55},
                            {x: 92, y: 50},
                            {x: 80, y: 48},
                            {x: 76, y: 50}
                        ],
                        objectBallLine: {from: {x: 92, y: 50}, to: {x: 98, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 78, y: 55}, {x: 92, y: 50}, {x: 80, y: 48}, {x: 76, y: 50}],
                        notes: 'Top spin, medium-firm pace. White runs through black into the pack. Aim to finish in the reds with 2-3 balls separated.'
                    },
                    {
                        title: 'Scenario 2: Split with Pink (Safer Option)',
                        balls: [
                            {type: 'white', x: 65, y: 48, label: 'W'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'red', x: 76, y: 48, label: '1'},
                            {type: 'red', x: 76, y: 52, label: '2'},
                            {type: 'red', x: 78, y: 50, label: '3'},
                            {type: 'red', x: 74, y: 50, label: '4'},
                            {type: 'red', x: 76, y: 50, label: '5', target: true}
                        ],
                        pocket: {x: 92, y: 50},
                        whitePath: [
                            {x: 65, y: 48},
                            {x: 75, y: 50},
                            {x: 76, y: 50}
                        ],
                        objectBallLine: {from: {x: 75, y: 50}, to: {x: 92, y: 50}, color: '#ff0000'},
                        whiteBallPath: [{x: 65, y: 48}, {x: 75, y: 50}, {x: 76, y: 50}],
                        notes: 'Top spin, medium pace. Pink is closer so less can go wrong. Good when you need controlled split.'
                    },
                    {
                        title: 'Scenario 3: Thin Cut Red into Pack (Advanced)',
                        balls: [
                            {type: 'white', x: 60, y: 40, label: 'W'},
                            {type: 'red', x: 72, y: 48, label: 'R'},
                            {type: 'red', x: 76, y: 48, label: '1'},
                            {type: 'red', x: 76, y: 52, label: '2'},
                            {type: 'red', x: 78, y: 50, label: '3'},
                            {type: 'red', x: 74, y: 50, label: '4'},
                            {type: 'red', x: 76, y: 50, label: '5', target: true}
                        ],
                        pocket: {x: 5, y: 30},
                        whitePath: [
                            {x: 60, y: 40},
                            {x: 72, y: 48},
                            {x: 76, y: 50}
                        ],
                        objectBallLine: {from: {x: 72, y: 48}, to: {x: 5, y: 30}, color: '#ff0000'},
                        whiteBallPath: [{x: 60, y: 40}, {x: 72, y: 48}, {x: 76, y: 50}],
                        notes: 'Thin cut red, top spin. Object ball goes to pack while white follows gently. Useful when no color available.'
                    },
                    {
                        title: 'Scenario 4: Cannon Split (Two Birds, One Stone)',
                        balls: [
                            {type: 'white', x: 50, y: 45, label: 'W'},
                            {type: 'red', x: 70, y: 48, label: 'R'},
                            {type: 'pink', x: 75, y: 50, label: 'P'},
                            {type: 'red', x: 76, y: 48, label: '1'},
                            {type: 'red', x: 76, y: 52, label: '2'},
                            {type: 'red', x: 78, y: 50, label: '3'},
                            {type: 'red', x: 74, y: 50, label: '4'},
                            {type: 'red', x: 76, y: 50, label: '5', target: true}
                        ],
                        pocket: {x: 5, y: 35},
                        whitePath: [
                            {x: 50, y: 45},
                            {x: 70, y: 48},
                            {x: 74, y: 49},
                            {x: 76, y: 50}
                        ],
                        objectBallLine: {from: {x: 70, y: 48}, to: {x: 5, y: 35}, color: '#ff0000'},
                        whiteBallPath: [{x: 50, y: 45}, {x: 70, y: 48}, {x: 74, y: 49}, {x: 76, y: 50}],
                        notes: 'Pot red, white cannons pink into pack, then white also goes into pack. High risk, high reward. Only when perfectly positioned.'
                    },
                    {
                        title: 'Scenario 5: Split from the Blue (Very Common)',
                        balls: [
                            {type: 'white', x: 40, y: 50, label: 'W'},
                            {type: 'blue', x: 50, y: 50, label: 'Bl'},
                            {type: 'red', x: 76, y: 48, label: '1'},
                            {type: 'red', x: 76, y: 52, label: '2'},
                            {type: 'red', x: 78, y: 50, label: '3'},
                            {type: 'red', x: 74, y: 50, label: '4'},
                            {type: 'red', x: 76, y: 50, label: '5', target: true}
                        ],
                        pocket: {x: 50, y: 5},
                        whitePath: [
                            {x: 40, y: 50},
                            {x: 50, y: 50},
                            {x: 65, y: 50},
                            {x: 76, y: 50}
                        ],
                        objectBallLine: {from: {x: 50, y: 50}, to: {x: 50, y: 5}, color: '#ff0000'},
                        whiteBallPath: [{x: 40, y: 50}, {x: 50, y: 50}, {x: 65, y: 50}, {x: 76, y: 50}],
                        notes: 'Top spin, firm pace (50-55%). Blue to top pocket, white runs straight through to pack. Perfect straight line = easy to judge. This is often the BEST time to split the pack.'
                    }
                ],
                instructions: [
                    'Set up 5-7 reds in a tight cluster near pink spot',
                    'Practice different ways to split them open',
                    'THE GOAL: Finish with white IN or NEAR the pack with balls separated',
                    'NOT to pot a red immediately after splitting - that comes later',
                    'Power is critical: Too soft = nothing happens. Too hard = white flies off',
                    'Medium-firm (45-50%) is usually right, firm (50-55%) for blue split',
                    'Top spin almost always - you want white to run through',
                    'Blue split is often the BEST opportunity - straight line, easy to judge',
                    'After splitting, assess: Can I pot 2-3 reds easily now?',
                    'Practice this until you\'re confident to attempt it in matches',
                    'This shot turns 30 breaks into 60+ breaks'
                ],
                notes: 'THIS IS THE SHOT. Every big break requires opening the pack at some point. Pros do this 2-3 times per century. You\'re making 62s in practice but not in matches because you either (a) don\'t split the pack, or (b) split it poorly and leave yourself nothing. Master this and your match breaks will jump 20-30 points immediately.'
            },
            'pressure-pots': {
                title: 'Pressure Pot Routine',
                objective: 'Build confidence on pots that make you uncomfortable. These are the shots you avoid in matches - this drill makes them routine.',
                duration: '20-25 minutes',
                diagrams: [
                    {
                        title: 'Uncomfortable Pot Positions',
                        balls: [
                            {type: 'white', x: 25, y: 45, label: 'W1'},
                            {type: 'red', x: 85, y: 35, label: '1'},
                            {type: 'white', x: 15, y: 50, label: 'W2'},
                            {type: 'red', x: 92, y: 50, label: '2'},
                            {type: 'white', x: 40, y: 30, label: 'W3'},
                            {type: 'red', x: 75, y: 70, label: '3'}
                        ],
                        notes: 'Set up 3-4 pots that you find difficult or awkward'
                    }
                ],
                instructions: [
                    'Identify 3-4 pots around the table that make you uncomfortable',
                    'These might be: awkward angles, long thin cuts, pots over another ball',
                    'For each pot, you must make it 10 times',
                    'If you miss, restart that ball\'s count from zero',
                    'Focus on committing to the pot - no steering',
                    'Use your pause drill technique on every shot',
                    'These pots should become automatic after 10 successful attempts',
                    'Change the pots each week as you master them'
                ],
                notes: 'In matches, you miss pots you "don\'t fancy." This drill removes that mental category. After potting the same shot 10 times, your brain registers it as easy.'
            },
            'coach-session': {
                title: 'Optimized Coach Session',
                objective: 'Use your century-break-making coach strategically instead of just playing frames where he beats you.',
                duration: '60-90 minutes',
                diagrams: [],
                instructions: [
                    'DON\'T just play frames - that wastes the session',
                    'Ask coach to call out which balls you should play for after each shot',
                    'This trains pattern recognition and angle visualization',
                    'Play frames where you get ball-in-hand after break',
                    'But you must make 30+ every time or restart',
                    'Have coach watch and correct your pause discipline',
                    'Ask coach to demonstrate the same shot you keep missing',
                    'Work on specific weaknesses: awkward angles, long pots, positional shots',
                    'Get feedback on your pre-shot routine and timing',
                    'Film some shots to review your cue action later'
                ],
                notes: 'Your coach is a century-breaker - use his expertise properly. Playing frames where he beats you 3-0 every time teaches you nothing. Make him analyze WHY you\'re missing, not just THAT you\'re missing.'
            }
        };
        
        // Practice Plan Generator
        function generatePlan(level) {
            const plans = {
                'beginner': {
                    title: '📚 Beginner Foundation Plan (90 minutes)',
                    routines: [
                        {name: 'Pause Drill', duration: 20, why: 'Build fundamentals - prevents snatching'},
                        {name: 'Common Position Potting', duration: 30, why: '10 essential pots you face every frame'},
                        {name: 'Natural Angles', duration: 20, why: 'Learn basic position without side spin'},
                        {name: 'Blue/Pink/Black Position', duration: 20, why: 'Simple color position practice'}
                    ],
                    notes: 'Focus 80% on technique, 20% on scoring. Master the pause before worrying about big breaks.'
                },
                'intermediate': {
                    title: '🎯 Intermediate Break-Building Plan (90 minutes)',
                    routines: [
                        {name: 'Pause Drill', duration: 15, why: 'Maintain fundamentals - NEVER skip this'},
                        {name: 'Black → Red Position', duration: 25, why: 'Most important shot for 40+ breaks'},
                        {name: 'Pink → Red Position', duration: 20, why: 'Master pink position play'},
                        {name: 'Opening the Pack', duration: 20, why: 'Turns 30s into 60s - critical skill'},
                        {name: 'Clearing Colors', duration: 10, why: 'Win frames by clearing the final 27'}
                    ],
                    notes: 'You can pot balls but need position control. Focus on getting 2-3 balls ahead, not just the next ball.'
                },
                'advanced': {
                    title: '🏆 Advanced Match-Ready Plan (90 minutes)',
                    routines: [
                        {name: 'Pause Drill', duration: 15, why: 'Under match pressure, this saves you'},
                        {name: 'Opening the Pack', duration: 30, why: 'Your 62s need consistent pack-splitting'},
                        {name: 'Cushion Position Play', duration: 20, why: 'Advanced position from difficult reds'},
                        {name: 'Common Position Potting', duration: 15, why: 'Stay sharp on bread-and-butter pots'},
                        {name: 'Pressure Pots', duration: 10, why: 'Build confidence under self-imposed pressure'}
                    ],
                    notes: 'You can make breaks in practice. Now focus on doing it under pressure. Every shot should use pause drill technique.'
                },
                'match-prep': {
                    title: '⚡ Match Preparation Plan (60 minutes)',
                    routines: [
                        {name: 'Pause Drill', duration: 20, why: 'This IS your match preparation'},
                        {name: 'Common Position Potting', duration: 20, why: 'Groove your stroke on realistic pots'},
                        {name: 'Clearing Colors', duration: 10, why: 'Build confidence on frame-winning sequence'},
                        {name: 'Pressure Pots', duration: 10, why: 'Final confidence boost'}
                    ],
                    notes: 'Match prep is about CONFIDENCE and RHYTHM, not learning new things. Keep it simple, focus on pause and smooth delivery.'
                }
            };
            
            const plan = plans[level];
            let html = `
                <div style="margin-bottom: 10px;">
                    <strong style="font-size: 1.1em;">${plan.title}</strong>
                </div>
                <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 5px; margin-bottom: 12px;">
            `;
            
            plan.routines.forEach((routine, index) => {
                html += `
                    <div style="margin-bottom: 8px; padding-bottom: 8px; ${index < plan.routines.length - 1 ? 'border-bottom: 1px solid rgba(255,255,255,0.2);' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong>${index + 1}. ${routine.name}</strong> 
                                <span style="opacity: 0.9; font-size: 0.9em;">(${routine.duration} min)</span>
                            </div>
                        </div>
                        <div style="font-size: 0.9em; opacity: 0.85; margin-top: 3px;">
                            💡 ${routine.why}
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px; font-size: 0.95em;">
                    <strong>📝 Key Focus:</strong> ${plan.notes}
                </div>
            `;
            
            document.getElementById('recommendedPlan').innerHTML = html;
        }
        
        function showRoutineSetup() {
            const routineKey = document.getElementById('practiceRoutine').value;
            const container = document.getElementById('routineSetup');
            
            if (!routineKey) {
                container.style.display = 'none';
                return;
            }
            
            const routine = routines[routineKey];
            container.style.display = 'block';
            
            let html = `
                <div class="routine-instructions">
                    <h3>${routine.title}</h3>
                    <div class="drill-objective">
                        <strong>🎯 Objective:</strong> ${routine.objective}
                    </div>
                    <div class="setup-note">
                        <strong>⏱️ Duration:</strong> ${routine.duration}
                    </div>
                    
                    <div class="strike-legend">
                        <div style="font-weight: bold; width: 100%; margin-bottom: 10px; color: #1e3c72; font-size: 1.1em;">Simple Diagram Guide:</div>
                        
                        <div class="strike-legend-item" style="width: 100%;">
                            <span style="border: 2px dashed white; padding: 2px 8px; background: rgba(255,255,255,0.3); border-radius: 3px;">- - -</span>
                            <span><strong>WHITE DASHED:</strong> Your aiming line to ghost ball</span>
                        </div>
                        
                        <div class="strike-legend-item" style="width: 100%;">
                            <div style="width: 20px; height: 20px; border-radius: 50%; background: rgba(255,255,255,0.3); border: 2px dashed rgba(255,255,255,0.6); display: flex; align-items: center; justify-content: center; font-size: 0.7em;">GB</div>
                            <span><strong>GHOST BALL:</strong> Contact point on object ball</span>
                        </div>
                        
                        <div class="strike-legend-item" style="width: 100%;">
                            <span style="background: #ff0000; padding: 2px 12px; border-radius: 3px; color: white;">━━</span>
                            <span><strong>RED LINE:</strong> Object ball to pocket</span>
                        </div>
                        
                        <div class="strike-legend-item" style="width: 100%;">
                            <span style="color: #ffd60a; font-size: 1.3em;">━━━➤</span>
                            <span><strong>YELLOW PATH:</strong> White ball after potting (your position)</span>
                        </div>
                        
                        <div class="strike-legend-item" style="width: 100%;">
                            <span style="color: #ffd60a; font-size: 1.4em;">⭐</span>
                            <span><strong>GLOWING RED:</strong> Your target - where to finish</span>
                        </div>
                        
                        <div style="width: 100%; margin: 10px 0; border-top: 2px solid #ddd;"></div>
                        
                        <div class="strike-legend-item" style="width: 100%;">
                            <div class="strike-dot" style="background: #00ff00;"></div>
                            <span>Top = Follow through</span>
                        </div>
                        <div class="strike-legend-item" style="width: 100%;">
                            <div class="strike-dot" style="background: #0000ff;"></div>
                            <span>Bottom = Screw back</span>
                        </div>
                    </div>
            `;
            
            // Add diagrams
            routine.diagrams.forEach((diagram, index) => {
                html += `
                    <h4 style="margin-top: 20px; color: #1e3c72;">${diagram.title}</h4>
                    <div style="text-align: right; margin-bottom: 10px;">
                        <button onclick="editDiagram(${JSON.stringify(diagram).replace(/"/g, '&quot;')})" style="
                            background: #667eea;
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 5px;
                            cursor: pointer;
                            font-weight: bold;
                        ">✏️ Edit This Diagram</button>
                    </div>
                    <div class="table-diagram">
                        <div class="table-inner"></div>
                        <div class="baulk-line"></div>
                        <div class="d-line"></div>
                        <div class="spot-marker" style="left: 20%; top: 50%;"></div>
                        <div class="spot-marker" style="left: 50%; top: 50%;"></div>
                        <div class="spot-marker" style="left: 75%; top: 50%;"></div>
                        <div class="spot-marker" style="left: 92%; top: 50%;"></div>
                `;
                
                // Add ghost ball first (behind other elements)
                if (diagram.ghostBall) {
                    html += `<div class="ball ghost" style="left: ${diagram.ghostBall.x}%; top: ${diagram.ghostBall.y}%; z-index: 2;">GB</div>`;
                }
                
                // Add white dashed aiming line (white to ghost ball) 
                if (diagram.ghostBall) {
                    const balls = diagram.balls;
                    const whiteBall = balls.find(b => b.type === 'white');
                    if (whiteBall) {
                        const al = {from: {x: whiteBall.x, y: whiteBall.y}, to: diagram.ghostBall};
                        const length = Math.sqrt(Math.pow(al.to.x - al.from.x, 2) + Math.pow(al.to.y - al.from.y, 2));
                        const angle = Math.atan2(al.to.y - al.from.y, al.to.x - al.from.x) * 180 / Math.PI;
                        html += `
                            <div class="aiming-line" style="
                                left: ${al.from.x}%;
                                top: ${al.from.y}%;
                                width: ${length}%;
                                transform: rotate(${angle}deg);
                                z-index: 1;
                            "></div>
                        `;
                    }
                }
                
                // Add RED line (object ball to pocket) with ARROW
                if (diagram.objectBallLine) {
                    const pl = diagram.objectBallLine;
                    const length = Math.sqrt(Math.pow(pl.to.x - pl.from.x, 2) + Math.pow(pl.to.y - pl.from.y, 2));
                    const angle = Math.atan2(pl.to.y - pl.from.y, pl.to.x - pl.from.x) * 180 / Math.PI;
                    html += `
                        <div style="
                            position: absolute;
                            left: ${pl.from.x}%;
                            top: ${pl.from.y}%;
                            width: ${length}%;
                            height: 5px;
                            background: ${pl.color};
                            transform: rotate(${angle}deg);
                            transform-origin: 0 50%;
                            z-index: 3;
                            box-shadow: 0 0 6px ${pl.color};
                        "></div>
                        <div style="
                            position: absolute;
                            left: ${pl.to.x}%;
                            top: ${pl.to.y}%;
                            width: 0;
                            height: 0;
                            border-left: 14px solid ${pl.color};
                            border-top: 8px solid transparent;
                            border-bottom: 8px solid transparent;
                            transform: translate(-14px, -8px) rotate(${angle}deg);
                            z-index: 3;
                            filter: drop-shadow(0 0 4px ${pl.color});
                        "></div>
                    `;
                }
                
                // Add YELLOW path (white ball path after contact)
                if (diagram.whiteBallPath) {
                    const path = diagram.whiteBallPath;
                    for (let i = 0; i < path.length - 1; i++) {
                        const x1 = path[i].x;
                        const y1 = path[i].y;
                        const x2 = path[i + 1].x;
                        const y2 = path[i + 1].y;
                        const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                        
                        html += `
                            <div style="
                                position: absolute;
                                left: ${x1}%;
                                top: ${y1}%;
                                width: ${length}%;
                                height: 5px;
                                background: #ffd60a;
                                transform: rotate(${angle}deg);
                                transform-origin: 0 50%;
                                box-shadow: 0 0 10px rgba(255, 214, 10, 0.8);
                                z-index: 2;
                            "></div>
                        `;
                    }
                    
                    // Add arrow at end of yellow path
                    const lastIdx = path.length - 1;
                    const prevIdx = path.length - 2;
                    const angle = Math.atan2(path[lastIdx].y - path[prevIdx].y, path[lastIdx].x - path[prevIdx].x) * 180 / Math.PI;
                    html += `
                        <div style="
                            position: absolute;
                            left: ${path[lastIdx].x}%;
                            top: ${path[lastIdx].y}%;
                            width: 0;
                            height: 0;
                            border-left: 16px solid #ffd60a;
                            border-top: 10px solid transparent;
                            border-bottom: 10px solid transparent;
                            transform: translate(-16px, -10px) rotate(${angle}deg);
                            filter: drop-shadow(0 0 6px rgba(255, 214, 10, 0.8));
                            z-index: 2;
                        "></div>
                    `;
                }
                
                // Add balls last (on top)
                diagram.balls.forEach(ball => {
                    const targetStyle = ball.target ? 
                        'box-shadow: 0 0 20px #ffd60a, 0 0 35px #ffd60a; z-index: 5;' : 
                        'z-index: 5;';
                    html += `<div class="ball ${ball.type}" style="left: ${ball.x}%; top: ${ball.y}%; ${targetStyle}">${ball.label}</div>`;
                });
                
                html += `</div>`;
                
                // Add strike visualization box BELOW the table
                if (diagram.strikeVisualization) {
                    const sv = diagram.strikeVisualization;
                    let strikeColor = '#ff0000';
                    if (sv.type === 'top') strikeColor = '#00ff00';
                    if (sv.type === 'screw') strikeColor = '#0000ff';
                    if (sv.type === 'top-right') strikeColor = '#00ffff';
                    if (sv.type === 'center') strikeColor = '#ff0000';
                    
                    // Calculate position within the ball (0,0 is center)
                    const percentX = 50 + (sv.strikeOffsetX / 30 * 50);
                    const percentY = 50 + (sv.strikeOffsetY / 30 * 50);
                    
                    html += `
                        <div class="strike-visualization">
                            <div style="font-weight: bold; text-align: center; margin-bottom: 10px; color: #1e3c72; font-size: 1.1em;">STRIKE HERE:</div>
                            <div class="strike-viz-ball">
                                <div class="strike-viz-point" style="
                                    left: ${percentX}%;
                                    top: ${percentY}%;
                                    background: ${strikeColor};
                                "></div>
                            </div>
                            <div style="text-align: center; font-size: 0.9em; color: #666; margin-top: 8px; font-weight: 600;">
                                ${sv.type === 'top' ? '✓ Top Spin' : sv.type === 'screw' ? '✓ Screw Back' : sv.type === 'top-right' ? '✓ Top-Right' : '✓ Plain Ball (Center)'}
                            </div>
                        </div>
                    `;
                }
                
                // Add shot details if present
                if (diagram.cueBall) {
                    html += `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; padding: 15px; background: #e9ecef; border-radius: 8px;">
                            <div style="background: white; padding: 12px; border-radius: 6px; border-left: 4px solid #667eea;">
                                <strong style="color: #1e3c72; display: block; margin-bottom: 5px;">⚡ Power:</strong>
                                <span style="font-size: 1.1em; color: #333;">${diagram.cueBall.power}</span>
                            </div>
                            <div style="background: white; padding: 12px; border-radius: 6px; border-left: 4px solid #667eea;">
                                <strong style="color: #1e3c72; display: block; margin-bottom: 5px;">🎯 Strike:</strong>
                                <span style="font-size: 1.1em; color: #333;">${diagram.cueBall.spin}</span>
                            </div>
                        </div>
                    `;
                }
                
                if (diagram.notes) {
                    html += `<p style="text-align: center; color: #666; font-style: italic; margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px;"><strong>💡 </strong>${diagram.notes}</p>`;
                }
            });
            
            // Add instructions
            html += `
                    <h4 style="margin-top: 20px; color: #1e3c72;">📋 Instructions</h4>
                    <ol>
            `;
            
            routine.instructions.forEach(instruction => {
                html += `<li>${instruction}</li>`;
            });
            
            html += `</ol>`;
            
            // Add notes
            if (routine.notes) {
                html += `
                    <div class="warning-box" style="margin-top: 20px;">
                        <strong>💡 Key Point:</strong> ${routine.notes}
                    </div>
                `;
            }
            
            html += `</div>`;
            
            container.innerHTML = html;
        }

        // Update cue action slider displays
        document.getElementById('cueActionRating').addEventListener('input', function() {
            document.getElementById('cueActionValue').textContent = this.value;
        });

        document.getElementById('matchCueAction').addEventListener('input', function() {
            document.getElementById('matchCueActionValue').textContent = this.value;
        });

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionId === 'dashboard') {
                updateDashboard();
            } else if (sectionId === 'analysis') {
                updateAnalysis();
            }
        }

        // Log practice session
        function logPracticeSession() {
            const routine = document.getElementById('practiceRoutine').value;
            const duration = parseInt(document.getElementById('practiceDuration').value);
            const cueAction = parseInt(document.getElementById('cueActionRating').value);
            const snatchCount = parseInt(document.getElementById('snatchCount').value);
            const highBreak = parseInt(document.getElementById('practiceBreak').value);
            const cost = parseFloat(document.getElementById('tableCost').value);
            const notes = document.getElementById('practiceNotes').value;
            
            const totalCost = (duration / 15) * cost;
            
            const session = {
                id: Date.now(),
                date: new Date().toISOString(),
                routine,
                duration,
                cueAction,
                snatchCount,
                highBreak,
                cost: totalCost.toFixed(2),
                notes
            };
            
            practiceData.unshift(session);
            localStorage.setItem('snookerPractice', JSON.stringify(practiceData));
            
            // Reset form
            document.getElementById('snatchCount').value = 0;
            document.getElementById('practiceBreak').value = 0;
            document.getElementById('practiceNotes').value = '';
            document.getElementById('cueActionRating').value = 5;
            document.getElementById('cueActionValue').textContent = 5;
            
            displayPracticeHistory();
            alert('Practice session logged successfully! 💪');
        }

        // Log match
        function logMatch() {
            const opponent = document.getElementById('opponentName').value;
            const matchType = document.getElementById('matchType').value;
            const result = document.getElementById('matchResult').value;
            const yourScore = parseInt(document.getElementById('yourScore').value);
            const oppScore = parseInt(document.getElementById('opponentScore').value);
            const highBreak = parseInt(document.getElementById('matchBreak').value);
            const cueAction = parseInt(document.getElementById('matchCueAction').value);
            const snatchCount = parseInt(document.getElementById('matchSnatchCount').value);
            const notes = document.getElementById('matchNotes').value;
            
            if (!opponent) {
                alert('Please enter opponent name');
                return;
            }
            
            const match = {
                id: Date.now(),
                date: new Date().toISOString(),
                opponent,
                matchType,
                result,
                yourScore,
                oppScore,
                highBreak,
                cueAction,
                snatchCount,
                notes
            };
            
            matchData.unshift(match);
            localStorage.setItem('snookerMatches', JSON.stringify(matchData));
            
            // Reset form
            document.getElementById('opponentName').value = '';
            document.getElementById('yourScore').value = 0;
            document.getElementById('opponentScore').value = 0;
            document.getElementById('matchBreak').value = 0;
            document.getElementById('matchSnatchCount').value = 0;
            document.getElementById('matchNotes').value = '';
            document.getElementById('matchCueAction').value = 5;
            document.getElementById('matchCueActionValue').textContent = 5;
            
            displayMatchHistory();
            alert('Match logged successfully! 🎱');
        }

        // Display practice history
        function displayPracticeHistory() {
            const container = document.getElementById('practiceHistory');
            if (practiceData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">No practice sessions logged yet.</p>';
                return;
            }
            
            container.innerHTML = '<h3 style="margin-top: 30px; color: #1e3c72;">Recent Sessions</h3>';
            practiceData.slice(0, 10).forEach(session => {
                const date = new Date(session.date).toLocaleDateString();
                container.innerHTML += `
                    <div class="session-item">
                        <h4>${session.routine.replace(/-/g, ' ').toUpperCase()} - ${date}</h4>
                        <div class="session-detail">
                            <span>⏱️ ${session.duration} mins</span>
                            <span>🎯 Cue Action: ${session.cueAction}/10</span>
                            <span>⚠️ Snatches: ${session.snatchCount}</span>
                            <span>🏆 High Break: ${session.highBreak}</span>
                            <span>💷 Cost: £${session.cost}</span>
                        </div>
                        ${session.notes ? `<p style="margin-top: 10px; color: #666;"><strong>Notes:</strong> ${session.notes}</p>` : ''}
                        <button class="delete-btn" onclick="deletePractice(${session.id})">Delete</button>
                    </div>
                `;
            });
        }

        // Display match history
        function displayMatchHistory() {
            const container = document.getElementById('matchHistory');
            if (matchData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">No matches logged yet.</p>';
                return;
            }
            
            container.innerHTML = '<h3 style="margin-top: 30px; color: #1e3c72;">Recent Matches</h3>';
            matchData.slice(0, 10).forEach(match => {
                const date = new Date(match.date).toLocaleDateString();
                const resultColor = match.result === 'won' ? '#28a745' : '#dc3545';
                container.innerHTML += `
                    <div class="session-item" style="border-left-color: ${resultColor}">
                        <h4>${match.matchType.toUpperCase()} vs ${match.opponent} - ${date}</h4>
                        <div class="session-detail">
                            <span style="color: ${resultColor}; font-weight: bold;">${match.result.toUpperCase()}</span>
                            <span>📊 ${match.yourScore} - ${match.oppScore}</span>
                            <span>🏆 High Break: ${match.highBreak}</span>
                            <span>🎯 Cue Action: ${match.cueAction}/10</span>
                            <span>⚠️ Snatches: ${match.snatchCount}</span>
                        </div>
                        ${match.notes ? `<p style="margin-top: 10px; color: #666;"><strong>Notes:</strong> ${match.notes}</p>` : ''}
                        <button class="delete-btn" onclick="deleteMatch(${match.id})">Delete</button>
                    </div>
                `;
            });
        }

        // Delete functions
        function deletePractice(id) {
            if (confirm('Delete this practice session?')) {
                practiceData = practiceData.filter(s => s.id !== id);
                localStorage.setItem('snookerPractice', JSON.stringify(practiceData));
                displayPracticeHistory();
                updateDashboard();
            }
        }

        function deleteMatch(id) {
            if (confirm('Delete this match?')) {
                matchData = matchData.filter(m => m.id !== id);
                localStorage.setItem('snookerMatches', JSON.stringify(matchData));
                displayMatchHistory();
                updateDashboard();
            }
        }

        // Update dashboard
        function updateDashboard() {
            document.getElementById('totalSessions').textContent = practiceData.length;
            document.getElementById('totalMatches').textContent = matchData.length;
            
            const wins = matchData.filter(m => m.result === 'won').length;
            const winRate = matchData.length > 0 ? ((wins / matchData.length) * 100).toFixed(0) : 0;
            document.getElementById('winRate').textContent = `${winRate}% win rate`;
            
            const allBreaks = [...practiceData.map(p => p.highBreak), ...matchData.map(m => m.highBreak)];
            const highest = allBreaks.length > 0 ? Math.max(...allBreaks) : 0;
            document.getElementById('highestBreak').textContent = highest;
            
            const avgCue = practiceData.length > 0 
                ? (practiceData.reduce((sum, p) => sum + p.cueAction, 0) / practiceData.length).toFixed(1)
                : 0;
            document.getElementById('avgCueAction').textContent = avgCue;
            
            updateCueActionChart();
        }

        // Update cue action chart
        function updateCueActionChart() {
            const ctx = document.getElementById('cueActionChart');
            if (!ctx) return;
            
            const last30Days = practiceData.filter(p => {
                const diff = Date.now() - new Date(p.date).getTime();
                return diff < 30 * 24 * 60 * 60 * 1000;
            }).reverse();
            
            const labels = last30Days.map(p => new Date(p.date).toLocaleDateString());
            const data = last30Days.map(p => p.cueAction);
            
            if (window.cueChart) {
                window.cueChart.destroy();
            }
            
            window.cueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cue Action Rating',
                        data: data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }

        // Update analysis section
        function updateAnalysis() {
            // Break comparison chart
            const breakCtx = document.getElementById('breakComparisonChart');
            if (breakCtx) {
                const practiceBreaks = practiceData.map(p => p.highBreak);
                const matchBreaks = matchData.map(m => m.highBreak);
                
                if (window.breakChart) {
                    window.breakChart.destroy();
                }
                
                window.breakChart = new Chart(breakCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Practice', 'Matches'],
                        datasets: [{
                            label: 'Average Break',
                            data: [
                                practiceBreaks.length > 0 ? practiceBreaks.reduce((a,b) => a+b, 0) / practiceBreaks.length : 0,
                                matchBreaks.length > 0 ? matchBreaks.reduce((a,b) => a+b, 0) / matchBreaks.length : 0
                            ],
                            backgroundColor: ['#667eea', '#764ba2']
                        }, {
                            label: 'Highest Break',
                            data: [
                                practiceBreaks.length > 0 ? Math.max(...practiceBreaks) : 0,
                                matchBreaks.length > 0 ? Math.max(...matchBreaks) : 0
                            ],
                            backgroundColor: ['#4facfe', '#00f2fe']
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Snatch trend chart
            const snatchCtx = document.getElementById('snatchTrendChart');
            if (snatchCtx) {
                const recentSessions = practiceData.slice(0, 10).reverse();
                
                if (window.snatchChart) {
                    window.snatchChart.destroy();
                }
                
                window.snatchChart = new Chart(snatchCtx, {
                    type: 'line',
                    data: {
                        labels: recentSessions.map((_, i) => `Session ${i+1}`),
                        datasets: [{
                            label: 'Snatch Count',
                            data: recentSessions.map(s => s.snatchCount),
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        // Initialize on load
        displayPracticeHistory();
        displayMatchHistory();
        updateDashboard();
        
        // Auto-load practice plan based on user profile (making 62s in practice = advanced)
        generatePlan('advanced');
        
        // Register Service Worker for PWA functionality (only works when self-hosted)
        if ('serviceWorker' in navigator && window.location.protocol === 'https:' && !window.location.hostname.includes('claudeusercontent')) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('✅ ServiceWorker registered - app works offline!');
                    })
                    .catch(err => {
                        console.log('ℹ️ ServiceWorker not available (normal in preview)');
                    });
            });
        } else {
            console.log('ℹ️ App running in preview mode. Full PWA features available when self-hosted.');
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
        });
        
        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) {
                alert('📱 To install:\n\niPhone: Tap Share → Add to Home Screen\nAndroid: Tap ⋮ menu → Install App\n\nFor full offline support, host these files on your own server/website.');
                return;
            }
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to install prompt: ${outcome}`);
            deferredPrompt = null;
            installButton.style.display = 'none';
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('✅ PWA installed successfully!');
            installButton.style.display = 'none';
        });
        
        // Show install button on mobile even without prompt
        if (/iPhone|iPad|Android/i.test(navigator.userAgent)) {
            setTimeout(() => {
                if (installButton.style.display === 'none') {
                    installButton.style.display = 'block';
                }
            }, 2000);
        }
        
        // Function to edit diagram in interactive editor
        function editDiagram(diagramData) {
            // Convert diagram data to editor format
            const editorData = {
                white: diagramData.balls.find(b => b.type === 'white') || {x: 60, y: 50},
                black: diagramData.balls.find(b => b.type === 'black') || {x: 92, y: 50},
                red: diagramData.balls.find(b => b.target) || {x: 40, y: 50},
                pocket: diagramData.pocket || {x: 98, y: 50},
                path: diagramData.whitePath || []
            };
            
            // Store in sessionStorage for editor
            sessionStorage.setItem('diagramToEdit', JSON.stringify(editorData));
            
            // Open editor in new window
            window.open('interactive-shot-diagram.html', '_blank');
        }
    </script>
</body>
</html>
