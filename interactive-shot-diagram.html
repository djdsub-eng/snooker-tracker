<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Snooker Diagram - Clean</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5f3f 100%);
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .instructions {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
        }
        
        .instructions ul {
            list-style: none;
            padding-left: 0;
        }
        
        .instructions li {
            margin: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .instructions li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #ffd700;
            font-weight: bold;
        }
        
        .table-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto 30px;
            background: #0a4d2e;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .table {
            position: relative;
            width: 100%;
            padding-bottom: 50%; /* 2:1 aspect ratio */
            background: linear-gradient(135deg, #0d7a3f 0%, #0a5f32 100%);
            border: 15px solid #8B4513;
            border-radius: 10px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.3);
            overflow: visible;
        }
        
        .baulk-line {
            position: absolute;
            left: 20%;
            top: 0;
            width: 2px;
            height: 100%;
            background: rgba(255,255,255,0.3);
        }
        
        .center-line {
            position: absolute;
            left: 50%;
            top: 0;
            width: 2px;
            height: 100%;
            background: rgba(255,255,255,0.2);
        }
        
        .ball {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: move;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4),
                        inset -5px -5px 10px rgba(0,0,0,0.3),
                        inset 5px 5px 10px rgba(255,255,255,0.3);
            z-index: 10;
            transition: transform 0.1s;
            user-select: none;
        }
        
        .ball:hover {
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 11;
        }
        
        .ball:active {
            cursor: grabbing;
        }
        
        .white {
            background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0);
        }
        
        .black {
            background: radial-gradient(circle at 30% 30%, #333333, #000000);
        }
        
        .red {
            background: radial-gradient(circle at 30% 30%, #ff4444, #cc0000);
        }
        
        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: visible;
        }
        
        .control-dot {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: move;
            transform: translate(-50%, -50%);
            z-index: 20;
            transition: all 0.2s;
            user-select: none;
            pointer-events: auto;
        }
        
        .control-dot:hover {
            transform: translate(-50%, -50%) scale(1.3);
        }
        
        .control-dot:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .pocket-dot {
            background: radial-gradient(circle at 30% 30%, #ff6666, #ff0000);
            border: 3px solid #ffff00;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8),
                        0 4px 8px rgba(0,0,0,0.4);
        }
        
        .path-dot {
            background: radial-gradient(circle at 30% 30%, #ffff66, #ffff00);
            border: 3px solid #ff8800;
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.8),
                        0 4px 8px rgba(0,0,0,0.4);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            background: #ffd700;
            color: #1a472a;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:hover {
            background: #ffed4e;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .preset-group {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }
        
        .info-box {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé± Interactive Snooker Shot Diagram</h1>
        
        <div class="instructions">
            <h3>üñ±Ô∏è How to Use:</h3>
            <ul>
                <li><strong>Drag the balls</strong> (white, black, red) to reposition them</li>
                <li><strong>Drag the RED dot</strong> to change where the black ball goes (pocket target)</li>
                <li><strong>Drag the YELLOW dots</strong> to shape the white ball's path</li>
                <li><strong>Add/Remove yellow dots</strong> using buttons below (2-6 control points)</li>
                <li><strong>Save presets</strong> to remember your shot setups</li>
            </ul>
        </div>
        
        <div class="table-container">
            <div id="table" class="table">
                <div class="baulk-line"></div>
                <div class="center-line"></div>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="addPathPoint()">‚ûï Add Yellow Dot</button>
            <button onclick="removePathPoint()">‚ûñ Remove Yellow Dot</button>
            <button onclick="resetDiagram()">üîÑ Reset</button>
        </div>
        
        <div class="controls">
            <div class="preset-group">
                <span><strong>Preset 1:</strong></span>
                <button onclick="savePreset(1)">üíæ Save</button>
                <button onclick="loadPreset(1)">üìÇ Load</button>
            </div>
            <div class="preset-group">
                <span><strong>Preset 2:</strong></span>
                <button onclick="savePreset(2)">üíæ Save</button>
                <button onclick="loadPreset(2)">üìÇ Load</button>
            </div>
            <div class="preset-group">
                <span><strong>Preset 3:</strong></span>
                <button onclick="savePreset(3)">üíæ Save</button>
                <button onclick="loadPreset(3)">üìÇ Load</button>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div style="width: 30px; height: 30px; background: radial-gradient(circle, white, #ccc); border-radius: 50%;"></div>
                <span><strong>White Ball:</strong> Cue ball position</span>
            </div>
            <div class="legend-item">
                <div style="width: 30px; height: 30px; background: radial-gradient(circle, #333, black); border-radius: 50%;"></div>
                <span><strong>Black Ball:</strong> Object ball</span>
            </div>
            <div class="legend-item">
                <div style="width: 30px; height: 30px; background: radial-gradient(circle, #ff6666, red); border-radius: 50%;"></div>
                <span><strong>Red Ball:</strong> Obstructing ball</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 3px; background: white;"></div>
                <span><strong>White Line:</strong> Aiming line</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 3px; background: red;"></div>
                <span><strong>Red Line:</strong> Black ball path to pocket</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 3px; background: yellow;"></div>
                <span><strong>Yellow Line:</strong> White ball curved path</span>
            </div>
            <div class="legend-item">
                <div style="width: 24px; height: 24px; background: radial-gradient(circle, #ff6666, red); border: 2px solid yellow; border-radius: 50%;"></div>
                <span><strong>Red Dot:</strong> Drag to change pocket</span>
            </div>
            <div class="legend-item">
                <div style="width: 24px; height: 24px; background: radial-gradient(circle, #ffff66, yellow); border: 2px solid orange; border-radius: 50%;"></div>
                <span><strong>Yellow Dots:</strong> Drag to bend path</span>
            </div>
        </div>
        
        <div class="info-box">
            <p><strong>üí° Tip:</strong> Shows a swerve/spin shot where the cue ball curves around the red to pot the black.</p>
        </div>
    </div>

    <script>
        // State - using simple percentage coordinates
        let state = {
            white: { x: 85, y: 50 },
            black: { x: 60, y: 50 },
            red: { x: 40, y: 50 },
            pocket: { x: 8, y: 50 },
            path: [
                { x: 85, y: 50 },  // Start at white ball
                { x: 55, y: 35 },  // Curve point 1
                { x: 8, y: 50 }    // End at pocket
            ]
        };

        let isDragging = false;
        let dragTarget = null;
        let dragType = null;
        let dragIndex = null;

        function init() {
            drawDiagram();
            setupEventListeners();
        }

        function drawDiagram() {
            const table = document.getElementById('table');
            
            // Clear existing elements (except static ones)
            Array.from(table.children).forEach(child => {
                if (!child.classList.contains('baulk-line') && !child.classList.contains('center-line')) {
                    child.remove();
                }
            });

            // Create SVG for lines
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.pointerEvents = 'none';
            table.appendChild(svg);

            // Calculate contact point for white line (where white touches black)
            const dx = state.black.x - state.white.x;
            const dy = state.black.y - state.white.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const ballRadiusPercent = 2; // Ball radius in percentage of table width
            const contactPoint = {
                x: state.black.x - (dx / distance) * ballRadiusPercent,
                y: state.black.y - (dy / distance) * ballRadiusPercent
            };

            // White aiming line (white ball center to contact point on black)
            const whiteLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            whiteLine.setAttribute('x1', state.white.x + '%');
            whiteLine.setAttribute('y1', state.white.y + '%');
            whiteLine.setAttribute('x2', contactPoint.x + '%');
            whiteLine.setAttribute('y2', contactPoint.y + '%');
            whiteLine.setAttribute('stroke', 'white');
            whiteLine.setAttribute('stroke-width', '2.5');
            whiteLine.setAttribute('stroke-dasharray', '5,5');
            svg.appendChild(whiteLine);

            // Red line (black ball center to pocket)
            const redLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            redLine.setAttribute('x1', state.black.x + '%');
            redLine.setAttribute('y1', state.black.y + '%');
            redLine.setAttribute('x2', state.pocket.x + '%');
            redLine.setAttribute('y2', state.pocket.y + '%');
            redLine.setAttribute('stroke', 'red');
            redLine.setAttribute('stroke-width', '4');
            svg.appendChild(redLine);

            // Yellow curved path - THE CUE BALL PATH
            // Draw as individual line segments for better visibility
            if (state.path.length >= 2) {
                for (let i = 0; i < state.path.length - 1; i++) {
                    const segment = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    segment.setAttribute('x1', state.path[i].x + '%');
                    segment.setAttribute('y1', state.path[i].y + '%');
                    segment.setAttribute('x2', state.path[i + 1].x + '%');
                    segment.setAttribute('y2', state.path[i + 1].y + '%');
                    segment.setAttribute('stroke', '#FFFF00');
                    segment.setAttribute('stroke-width', '6');
                    segment.setAttribute('stroke-linecap', 'round');
                    svg.appendChild(segment);
                }
                console.log('Yellow path drawn with', state.path.length, 'points as line segments');
            }

            // Draw balls
            drawBall('white', state.white.x, state.white.y, 'white');
            drawBall('black', state.black.x, state.black.y, 'black');
            drawBall('red', state.red.x, state.red.y, 'red');

            // Draw control dots
            // Red dot for pocket control
            drawControlDot('pocket', state.pocket.x, state.pocket.y, 'pocket-dot');
            
            // Yellow dots for path control (skip first point at white ball, skip last point at pocket)
            for (let i = 1; i < state.path.length - 1; i++) {
                drawControlDot('path', state.path[i].x, state.path[i].y, 'path-dot', i);
            }
        }

        function drawBall(id, x, y, className) {
            const ball = document.createElement('div');
            ball.className = `ball ${className}`;
            ball.style.left = x + '%';
            ball.style.top = y + '%';
            ball.dataset.type = 'ball';
            ball.dataset.id = id;
            document.getElementById('table').appendChild(ball);
        }

        function drawControlDot(type, x, y, className, index) {
            const dot = document.createElement('div');
            dot.className = `control-dot ${className}`;
            dot.style.left = x + '%';
            dot.style.top = y + '%';
            dot.dataset.type = type;
            if (index !== undefined) {
                dot.dataset.index = index;
            }
            document.getElementById('table').appendChild(dot);
        }

        function setupEventListeners() {
            const table = document.getElementById('table');
            
            table.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            table.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', stopDrag);
        }

        function startDrag(e) {
            e.preventDefault();
            const target = e.target;
            
            if (target.classList.contains('ball')) {
                isDragging = true;
                dragTarget = target;
                dragType = 'ball';
                dragTarget.style.zIndex = '50';
            } else if (target.classList.contains('control-dot')) {
                isDragging = true;
                dragTarget = target;
                dragType = target.dataset.type;
                if (dragType === 'path') {
                    dragIndex = parseInt(target.dataset.index);
                }
                dragTarget.style.zIndex = '50';
            }
        }

        function drag(e) {
            if (!isDragging || !dragTarget) return;
            
            e.preventDefault();
            const table = document.getElementById('table');
            const rect = table.getBoundingClientRect();
            
            let clientX, clientY;
            if (e.type.startsWith('touch')) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const x = ((clientX - rect.left) / rect.width) * 100;
            const y = ((clientY - rect.top) / rect.height) * 100;
            
            // Constrain to table
            const constrainedX = Math.max(2, Math.min(98, x));
            const constrainedY = Math.max(2, Math.min(98, y));
            
            if (dragType === 'ball') {
                const ballId = dragTarget.dataset.id;
                state[ballId].x = constrainedX;
                state[ballId].y = constrainedY;
                
                // Update white ball path start
                if (ballId === 'white') {
                    state.path[0].x = constrainedX;
                    state.path[0].y = constrainedY;
                }
            } else if (dragType === 'pocket') {
                state.pocket.x = constrainedX;
                state.pocket.y = constrainedY;
                // Update path end point
                state.path[state.path.length - 1].x = constrainedX;
                state.path[state.path.length - 1].y = constrainedY;
            } else if (dragType === 'path') {
                state.path[dragIndex].x = constrainedX;
                state.path[dragIndex].y = constrainedY;
            }
            
            drawDiagram();
        }

        function stopDrag(e) {
            if (isDragging) {
                e.preventDefault();
                isDragging = false;
                if (dragTarget) {
                    dragTarget.style.zIndex = '';
                }
                dragTarget = null;
                dragType = null;
                dragIndex = null;
            }
        }

        function addPathPoint() {
            // Max 10 path points total (including start and end)
            if (state.path.length >= 10) {
                alert('‚ö†Ô∏è Maximum 10 path points!');
                return;
            }
            
            // Add between last two points
            const lastIdx = state.path.length - 1;
            const newPoint = {
                x: (state.path[lastIdx - 1].x + state.path[lastIdx].x) / 2,
                y: (state.path[lastIdx - 1].y + state.path[lastIdx].y) / 2
            };
            
            state.path.splice(lastIdx, 0, newPoint);
            drawDiagram();
        }

        function removePathPoint() {
            // Min 2 points (start and end)
            if (state.path.length <= 2) {
                alert('‚ö†Ô∏è Need at least 2 path points!');
                return;
            }
            
            // Remove second-to-last (keep start and end)
            state.path.splice(state.path.length - 2, 1);
            drawDiagram();
        }

        function resetDiagram() {
            if (confirm('üîÑ Reset to default?')) {
                state = {
                    white: { x: 85, y: 50 },
                    black: { x: 60, y: 50 },
                    red: { x: 40, y: 50 },
                    pocket: { x: 8, y: 50 },
                    path: [
                        { x: 85, y: 50 },
                        { x: 55, y: 35 },
                        { x: 8, y: 50 }
                    ]
                };
                drawDiagram();
            }
        }

        function savePreset(num) {
            localStorage.setItem(`snookerPreset${num}`, JSON.stringify(state));
            alert(`‚úÖ Preset ${num} saved!`);
        }

        function loadPreset(num) {
            const preset = localStorage.getItem(`snookerPreset${num}`);
            if (preset) {
                state = JSON.parse(preset);
                drawDiagram();
                alert(`‚úÖ Preset ${num} loaded!`);
            } else {
                alert(`‚ùå No preset ${num} saved yet!`);
            }
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
